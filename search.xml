<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>JAR包加密class文件防止反编译</title>
    <url>/2022/08/09/JAR%E5%8C%85%E5%8A%A0%E5%AF%86class%E6%96%87%E4%BB%B6%E9%98%B2%E6%AD%A2%E5%8F%8D%E7%BC%96%E8%AF%91/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>通常来说，将代码打成jar包后，可以通过反编译工具得到源码。这对于代码隐蔽性是极大的挑战。常用的加密方式有代码混淆、编译加密运行动态解密、魔改JVM等；</p>
<p>本文采用第二种方式；</p>
<h2 id="编译期加密"><a href="#编译期加密" class="headerlink" title="编译期加密"></a>编译期加密</h2><h3 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h3><p>首先要知道，代码变为jar包需要经过编译的；maven将编译后的class文件统一打成jar包。但是这样，就等于泄露了代码源文件。所以需要在maven编译时做出调整，将指定的class替换成加密后的class，然后再打进jar包；</p>
<h3 id="maven插件"><a href="#maven插件" class="headerlink" title="maven插件"></a>maven插件</h3><p>通过自定义maven插件进行的实现</p>
<p>首先我们来看pom.xml文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.bubuzi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>encryption-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    注意，这里的打包模式必须是maven-plugin   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>maven-plugin<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>bubuzi.changsha.RS1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        maven插件开发需引入的依赖     --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        版本随你的maven版本变动     --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-plugin-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写插件加密类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.bubuzi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.bubuzi.SafeLoaderUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.AbstractMojo;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.MojoExecutionException;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.MojoFailureException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@goal</span> deepcompile</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="comment">//@Mojo(name = &quot;brakeFramePlugin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FramePlugin</span> <span class="keyword">extends</span> <span class="title">AbstractMojo</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 这里前三个成员变量注释请勿修改，这是读取maven配置的固定写法</span></span><br><span class="line">    <span class="comment">// 当然也有使用@Mojo的写法，需要引入额外的依赖，这里不做多介绍</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@parameter</span> property=&quot;protectClassNames&quot; default-value=&quot;&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; protectClassNames;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@parameter</span> property=&quot;noCompileClassNames&quot; default-value=&quot;&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; noCompileClassNames;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@parameter</span> property=&quot;output&quot; default-value=&quot;$&#123;project.build.directory&#125;&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String root;</span><br><span class="line">    <span class="keyword">private</span> File output;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; protectClassNameList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> MojoExecutionException, MojoFailureException </span>&#123;</span><br><span class="line">        getLog().info(<span class="string">&quot;执行jar包加密操作&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.output = <span class="keyword">new</span> File(root);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.protectCore(<span class="keyword">this</span>.output);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">protectCore</span><span class="params">(File root)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root.isDirectory()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (File file : root.listFiles()) &#123;</span><br><span class="line">                protectCore(file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (root.getName().endsWith(<span class="string">&quot;.class&quot;</span>)) &#123;</span><br><span class="line">            String className = root.getName().replace(<span class="string">&quot;.class&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="comment">//class筛选</span></span><br><span class="line">            <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (protectClassNames != <span class="keyword">null</span> &amp;&amp; protectClassNames.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (String item : protectClassNames) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (className.equals(item)) &#123;</span><br><span class="line">                        flag = <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (noCompileClassNames.contains(className)) &#123;</span><br><span class="line">                <span class="keyword">boolean</span> deleteResult = root.delete();</span><br><span class="line">                <span class="keyword">if</span> (!deleteResult) &#123;</span><br><span class="line">                    System.gc();</span><br><span class="line">                    deleteResult = root.delete();</span><br><span class="line">                &#125;</span><br><span class="line">                getLog().info(String.format(<span class="string">&quot;[noCompile-deleteResult]:%s&quot;</span>, deleteResult));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (flag &amp;&amp; !protectClassNameList.contains(className)) &#123;</span><br><span class="line">                protectClassNameList.add(className);</span><br><span class="line">                getLog().info(String.format(<span class="string">&quot;[protectCore]:%s&quot;</span>, className));</span><br><span class="line">                FileOutputStream fos = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">byte</span>[] instrumentBytes = doProtectCore(root);</span><br><span class="line">                    <span class="comment">//加密后的class文件保存路径</span></span><br><span class="line">                    String folderPath = output.getAbsolutePath() + <span class="string">&quot;\\&quot;</span> + <span class="string">&quot;classes&quot;</span>;</span><br><span class="line">                    File folder = <span class="keyword">new</span> File(folderPath);</span><br><span class="line">                    <span class="keyword">if</span> (!folder.exists()) &#123;</span><br><span class="line">                        folder.mkdir();</span><br><span class="line">                    &#125;</span><br><span class="line">                    folderPath = output.getAbsolutePath() + <span class="string">&quot;\\&quot;</span> + <span class="string">&quot;classes&quot;</span> + <span class="string">&quot;\\&quot;</span> + <span class="string">&quot;coreclass&quot;</span>;</span><br><span class="line">                    folder = <span class="keyword">new</span> File(folderPath);</span><br><span class="line">                    <span class="keyword">if</span> (!folder.exists()) &#123;</span><br><span class="line">                        folder.mkdir();</span><br><span class="line">                    &#125;</span><br><span class="line">                    String filePath = output.getAbsolutePath() + <span class="string">&quot;\\&quot;</span> + <span class="string">&quot;classes&quot;</span> + <span class="string">&quot;\\&quot;</span> + <span class="string">&quot;coreclass&quot;</span> + <span class="string">&quot;\\&quot;</span> + className + <span class="string">&quot;.class&quot;</span>;</span><br><span class="line">                    getLog().info(<span class="string">&quot;[filePath]: &quot;</span> + filePath);</span><br><span class="line">                    File protectFile = <span class="keyword">new</span> File(filePath);</span><br><span class="line">                    <span class="keyword">if</span> (protectFile.exists()) &#123;</span><br><span class="line">                        protectFile.delete();</span><br><span class="line">                    &#125;</span><br><span class="line">                    protectFile.createNewFile();</span><br><span class="line">                    fos = <span class="keyword">new</span> FileOutputStream(protectFile);</span><br><span class="line">                    fos.write(instrumentBytes);</span><br><span class="line">                    fos.flush();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    getLog().info(<span class="string">&quot;[protectCore-exception]:&quot;</span> + className);</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (fos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        fos.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (root.exists()) &#123;</span><br><span class="line">                        <span class="keyword">boolean</span> deleteResult = root.delete();</span><br><span class="line">                        <span class="keyword">if</span> (!deleteResult) &#123;</span><br><span class="line">                            System.gc();</span><br><span class="line">                            deleteResult = root.delete();</span><br><span class="line">                        &#125;</span><br><span class="line">                        getLog().info(<span class="string">&quot;[protectCore-deleteResult]:&quot;</span> + deleteResult);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] doProtectCore(File clsFile) <span class="keyword">throws</span> MojoExecutionException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(clsFile);</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) clsFile.length()];</span><br><span class="line">            getLog().info(<span class="string">&quot;origin length:&quot;</span> + bytes.length);</span><br><span class="line">            inputStream.read(bytes);</span><br><span class="line">            <span class="comment">// jdk9+</span></span><br><span class="line"><span class="comment">//            byte[] bytes = inputStream.readAllBytes();</span></span><br><span class="line">            <span class="comment">// SafeLoaderUtil.encryption加密为JNI调用的C++程序，可以采用不同实现</span></span><br><span class="line">            <span class="keyword">byte</span>[] encipherByte = SafeLoaderUtil.encryption(bytes);</span><br><span class="line">            inputStream.close();</span><br><span class="line">            <span class="keyword">return</span> encipherByte;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MojoExecutionException(<span class="string">&quot;doProtectCore error&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>代码种的SafeLoaderUtil.encryption的JNI调用方法可参考上一篇文章</p>
<h3 id="maven插件打包安装"><a href="#maven插件打包安装" class="headerlink" title="maven插件打包安装"></a>maven插件打包安装</h3><p><strong>一定要安装至本地！！！</strong></p>
<p><strong>一定要安装至本地！！！</strong></p>
<p><strong>一定要安装至本地！！！</strong></p>
<p><img src="https://s2.loli.net/2022/08/09/s2ETPfuq19XRdUY.png" alt="image-20220809092513798"></p>
<h3 id="加密项目配置"><a href="#加密项目配置" class="headerlink" title="加密项目配置"></a>加密项目配置</h3><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            引入maven加密插件     --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.bubuzi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>encryption-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>bubuzi.changsha.RS1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--            必须填写，设置编译器动作     --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>deepcompile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--            这里可改为全类名，暂时未优化     --&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--            写入需要加密的类名称     --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">protectClassNames</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">protectClassName</span>&gt;</span>LoginServiceImpl<span class="tag">&lt;/<span class="name">protectClassName</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">protectClassNames</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h4><p>配置好pom后，就可以愉快的打包了</p>
<p>可以看见，日志中正确输出了打包相关内容。</p>
<p><img src="https://s2.loli.net/2022/08/09/evlqKtF9EHB1Lg2.png" alt="image-20220809093251630"></p>
<p>项目结构里，LoginServiceImpl类应该存在于impl包下</p>
<p><img src="https://s2.loli.net/2022/08/09/j5XEgWHGUIR93nb.png" alt="image-20220809093411656"></p>
<p>查看jar包内结构</p>
<p>使用压缩包的模式打开jar</p>
<p><img src="https://s2.loli.net/2022/08/09/n3NaTOxPQclvXzK.png" alt="image-20220809093533570"></p>
<p><img src="https://s2.loli.net/2022/08/09/c6bvi7ptkFq1YAN.png" alt="image-20220809093548178"></p>
<p><img src="https://s2.loli.net/2022/08/09/NWAUI8zZ3PMaulE.png" alt="image-20220809093632308"></p>
<p><img src="https://s2.loli.net/2022/08/09/bsnF6YT95vSeZUy.png" alt="image-20220809093702549"><br>可以看见，本应在impl包下的LoginServiceImpl类，去了coreclass文件夹下</p>
<p>这就是加密完成</p>
<p>通过idea反编译加密class文件，可以看见根本无法查阅</p>
<p><img src="https://s2.loli.net/2022/08/09/Cer1kmRSciWExvy.png" alt="image-20220809095217583"></p>
<h2 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h2><h3 id="运行时解密"><a href="#运行时解密" class="headerlink" title="运行时解密"></a>运行时解密</h3><p>在这里我查阅了许多资料，始终没能找到使我满意的解答方式；</p>
<p>这与springboot的加载机制有关系，起初我想用classloader的方式动态加载，一直未能成功，感兴趣的同志可以去了解以下springboot的加载机制，还有要注意jdk版本问题，jdk8及以下与jdk8以上的类加载机制有部分变化；</p>
<p>最终采用的一种折中方案；</p>
<p>我们都知道，spring会将beanClass封装成一个BeanDefinition对象，然后再通过bean别名，一一对应的方式注册进IOC容器；</p>
<p>所以，我们只需要在spring容器启动后，手动将加密类注册进容器，后续bean创建时，就会使用我们注入的class；</p>
<h3 id="解密类"><a href="#解密类" class="headerlink" title="解密类"></a>解密类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticEncryptLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> StaticEncryptLoader INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// spring bean 默认bean工厂</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> DefaultListableBeanFactory beanFactory;</span><br><span class="line">    <span class="comment">// 用于存储class类</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Class&gt; classes = <span class="keyword">new</span> ConcurrentHashMap();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// jni调用，请查看上一章</span></span><br><span class="line">        System.loadLibrary(<span class="string">&quot;EncryptionLoader&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">StaticEncryptLoader</span><span class="params">(ClassLoader parent)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(parent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  StaticEncryptLoader <span class="title">getInstance</span><span class="params">(ClassLoader parent)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(INSTANCE == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (StaticEncryptLoader.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(INSTANCE == <span class="keyword">null</span>)&#123;</span><br><span class="line">                    INSTANCE = <span class="keyword">new</span> StaticEncryptLoader(parent);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StaticEncryptLoader <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于加载所有加密类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            loadClasses2Cache();</span><br><span class="line"><span class="comment">//            checkPool.scheduleWithFixedDelay(() -&gt; &#123;</span></span><br><span class="line"><span class="comment">//                try &#123;</span></span><br><span class="line"><span class="comment">//                    loadClasses2Cache();</span></span><br><span class="line"><span class="comment">//                &#125; catch (IOException e) &#123;</span></span><br><span class="line"><span class="comment">//                    e.printStackTrace();</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125;, 60, 60, TimeUnit.SECONDS);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadClasses2Cache</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Resource[] resources = <span class="keyword">new</span> PathMatchingResourcePatternResolver().getResources(<span class="string">&quot;/coreclass/**/*.class&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(Resource resource : resources) &#123;</span><br><span class="line">            <span class="keyword">byte</span> pack[] = <span class="keyword">null</span>;</span><br><span class="line">            InputStream inputStream = resource.getInputStream();</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(count == <span class="number">0</span>)&#123;</span><br><span class="line">                count = inputStream.available();</span><br><span class="line">            &#125;</span><br><span class="line">            pack = <span class="keyword">new</span> <span class="keyword">byte</span>[count];</span><br><span class="line">            <span class="keyword">int</span> readCount = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (readCount &lt; count) &#123;</span><br><span class="line">                readCount += inputStream.read(pack, readCount, count - readCount);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">byte</span>[] decryption = SafeLoaderUtil.decryption(pack);</span><br><span class="line">            Class&lt;?&gt; aClass = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                aClass = defineClass(<span class="string">&quot;top.bubuzi.service.impl.LoginServiceImpl&quot;</span>, decryption, <span class="number">0</span>, decryption.length);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassFormatError classFormatError) &#123;</span><br><span class="line">                classFormatError.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 由于现在只写了一个加密类，直接全类名注入了，实际操作时，需要将全路径匹配为全类名</span></span><br><span class="line">            <span class="comment">// 如，现在为coreclass/LoginServiceImpl，后续调整为，coreclass</span></span><br><span class="line">            classes.put(<span class="string">&quot;top.bubuzi.service.impl.LoginServiceImpl&quot;</span>,aClass);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registryBeans</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(classes) &amp;&amp; beanFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">            classes.forEach(</span><br><span class="line">                    (k, v) -&gt; &#123;</span><br><span class="line">                        registryBean(k);</span><br><span class="line">                    &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向spring容器注入beanDefinition</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> className 全限定名 (com.xxx.xx.XXXX)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">registryBean</span><span class="params">(String className)</span> </span>&#123;</span><br><span class="line">        Class cla = classes.get(className.replace(<span class="string">&quot;.class&quot;</span>, <span class="string">&quot;&quot;</span>).replaceAll(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span> (SpringUtil.isSpringBeanClass(cla) &amp;&amp; beanFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">            BeanDefinition beanDefinition = SpringUtil.buildBeanDefinition(cla);</span><br><span class="line">            <span class="comment">//将变量首字母置小写</span></span><br><span class="line">            String beanName = StringUtils.uncapitalize(className);</span><br><span class="line">            beanName = beanName.substring(beanName.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">            beanName = StringUtils.uncapitalize(beanName);</span><br><span class="line">            <span class="comment">// 注意，这里的beanName为ioc容器自动注入提供服务，请确保你的容器名称是否匹配</span></span><br><span class="line">            safeRegistry(className, beanDefinition);</span><br><span class="line">            safeRegistry(beanName, beanDefinition);</span><br><span class="line">            <span class="keyword">if</span>(beanName.endsWith(<span class="string">&quot;Impl&quot;</span>) )&#123;</span><br><span class="line">                safeRegistry(beanName.replace(<span class="string">&quot;Impl&quot;</span>,<span class="string">&quot;&quot;</span>), beanDefinition);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">safeRegistry</span><span class="params">(String name,BeanDefinition beanDefinition)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!beanFactory.containsBean(name))&#123;</span><br><span class="line">            beanFactory.registerBeanDefinition(name,beanDefinition);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Object bean = beanFactory.getBean(name);</span><br><span class="line">            System.out.println(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="容器加载类"><a href="#容器加载类" class="headerlink" title="容器加载类"></a>容器加载类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringRegistry</span> <span class="keyword">implements</span> <span class="title">BeanFactoryPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        StaticEncryptLoader instance = StaticEncryptLoader.getInstance();</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        instance.setBeanFactory((DefaultListableBeanFactory) beanFactory);</span><br><span class="line">        <span class="keyword">if</span>(!(beanFactory.getBeanClassLoader() <span class="keyword">instanceof</span> StaticEncryptLoader))&#123;</span><br><span class="line">            beanFactory.setBeanClassLoader(instance);</span><br><span class="line">        &#125;</span><br><span class="line">        instance.registryBeans();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &quot;top.bubuzi&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;top.bubuzi.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlatformApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加载加密类元信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        StaticEncryptLoader instance = StaticEncryptLoader.getInstance(PlatformApplication.class.getClassLoader());</span><br><span class="line">        instance.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PlatformApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>启动后正常无报错即加密成功</p>
<h2 id="后文"><a href="#后文" class="headerlink" title="后文"></a>后文</h2><p>本方法只能避免jar包直接被反编译，不能实现完全的加密防护，实际上百分百防护是做不到的；</p>
<p>但是这里依旧有优化项点：</p>
<pre><code>*    不采用beanFactory，而采用classLoader的方式
*    加密classLoader，隐藏解密程序，classLoader采用分片注入程序的方式
*    核心代码用安全性高的语言实现，如c++实现后jni调用
*    魔改JVM加载机制
</code></pre>
<p>希望本文能帮到你</p>
]]></content>
      <tags>
        <tag>JNI</tag>
        <tag>加密</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVA与C++交互（JNI）</title>
    <url>/2022/08/09/JAVA%E4%B8%8EC-%E4%BA%A4%E4%BA%92%EF%BC%88JNI%EF%BC%89/</url>
    <content><![CDATA[<h1 id="JNI"><a href="#JNI" class="headerlink" title="JNI"></a>JNI</h1><h2 id="编写Java类"><a href="#编写Java类" class="headerlink" title="编写Java类"></a>编写Java类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hnzdf.brakePlatform.maven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMain</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">testHello</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;TestMain&quot;</span>);</span><br><span class="line">        TestMain jniDemo = <span class="keyword">new</span> TestMain();</span><br><span class="line">        jniDemo.testHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="生成头文件"><a href="#生成头文件" class="headerlink" title="生成头文件"></a>生成头文件</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">javac -h .  cn\hnzdf\brakePlatform\maven\TestMain.java</span><br></pre></td></tr></table></figure>

<p>执行后会在路径下生成头文件，cn_hnzdf_brakePlatform_maven_TestMain.h</p>
<p><img src="https://s2.loli.net/2022/08/04/Rvktb6VOfhQX5Gs.png" alt="image-20220804144508009"></p>
<h2 id="编写c-代码"><a href="#编写c-代码" class="headerlink" title="编写c++代码"></a>编写c++代码</h2><h3 id="在Visual-Studio中新建项目"><a href="#在Visual-Studio中新建项目" class="headerlink" title="在Visual Studio中新建项目"></a>在Visual Studio中新建项目</h3><p>选择动态链接库</p>
<p><img src="https://s2.loli.net/2022/08/04/2ShEdx7agArjz3P.png" alt="image-20220804144301505"></p>
<p><img src="https://s2.loli.net/2022/08/04/RzdAoXMxHkPy9Dq.png" alt="image-20220804144345606"></p>
<p>建完以后的结构</p>
<p><img src="https://s2.loli.net/2022/08/04/EaLi2yjWhonZg6R.png" alt="image-20220804144416544"></p>
<h3 id="将必要头文件拷贝进项目"><a href="#将必要头文件拷贝进项目" class="headerlink" title="将必要头文件拷贝进项目"></a>将必要头文件拷贝进项目</h3><ol>
<li>需要具体实现的头文件，cn_hnzdf_brakePlatform_maven_TestMain.h；</li>
<li>jni.h，该文件在jdk安装目录下，如：D:\ENV\Java\jdk-11.0.11\include\jni.h</li>
<li>jni_md.h，该文件在jdk安装目录下，如：D:\ENV\Java\jdk-11.0.11\include\win32\jni_md.h</li>
</ol>
<p><strong>一定要使用vs自己的导入，切不可直接粘贴</strong></p>
<p><strong>一定要使用vs自己的导入，切不可直接粘贴</strong></p>
<p><strong>一定要使用vs自己的导入，切不可直接粘贴</strong></p>
<p><img src="https://s2.loli.net/2022/08/04/HTLR87w9fm3yWMI.png" alt="image-20220804145056181"></p>
<h3 id="新建实现类"><a href="#新建实现类" class="headerlink" title="新建实现类"></a>新建实现类</h3><p>右键源代码，直接创建类</p>
<p><img src="https://s2.loli.net/2022/08/04/eulgirwCyKh3Spf.png" alt="image-20220804145441318"><img src="https://s2.loli.net/2022/08/04/OKvqtiDb8hX7uME.png" alt="image-20220804145734320"></p>
<p>在类的头文件中导入必要依赖</p>
<p><img src="https://s2.loli.net/2022/08/04/xPkWGhNKeByvAY1.png" alt="image-20220804145804999"></p>
<p>在TestMain.cpp中写入以下内容，注意”pch.h”必须依赖</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;TestMain.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">JNIEXPORT <span class="keyword">void</span> JNICALL Java_cn_hnzdf_brakePlatform_maven_TestMain_testHello</span><br><span class="line">(JNIEnv*, jobject) &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;this is C++ print&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="引用调整"><a href="#引用调整" class="headerlink" title="引用调整"></a>引用调整</h3><p>生成的头文件中的引用，</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 原来</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="comment">// 改为</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;jni.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h3><p>右键解决方案，点击生成</p>
<p><img src="https://s2.loli.net/2022/08/04/jrNiKs8cWR4SmOA.png" alt="image-20220804150014717"></p>
<h3 id="将生成的dll拷贝至jdk安装目录的bin目录下"><a href="#将生成的dll拷贝至jdk安装目录的bin目录下" class="headerlink" title="将生成的dll拷贝至jdk安装目录的bin目录下"></a>将生成的dll拷贝至jdk安装目录的bin目录下</h3><h3 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 这里不要写dll后缀</span></span><br><span class="line">        System.loadLibrary(<span class="string">&quot;TestMain&quot;</span>);</span><br><span class="line">        TestMain jniDemo = <span class="keyword">new</span> TestMain();</span><br><span class="line">        jniDemo.testHello();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://s2.loli.net/2022/08/04/qs31PELmkaplTUi.png" alt="image-20220804150151500"></p>
]]></content>
      <categories>
        <category>JNI</category>
      </categories>
      <tags>
        <tag>JNI</tag>
        <tag>JAVA</tag>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>Tomcat源码分析————Tomcat类加载</title>
    <url>/2022/04/28/Tomcat%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E2%80%94%E2%80%94%E2%80%94%E2%80%94Tomcat%E7%B1%BB%E5%8A%A0%E8%BD%BD/</url>
    <content><![CDATA[<h1 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h1><h2 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h2><p>类加载的过程中，“通过一个类的全限定名来获取描述此类的二级制字节流”这个动作放到JVM虚拟机外部去实现，由用户程序自己去选择如何加载所需的类；实现此方法的类便是类加载器；</p>
<h2 id="JVM中是如何判断两个Class是否相等的？"><a href="#JVM中是如何判断两个Class是否相等的？" class="headerlink" title="JVM中是如何判断两个Class是否相等的？"></a>JVM中是如何判断两个Class是否相等的？</h2><p>类加载器将类元数据装载至JVM。</p>
<p>对任意的一个类来说，都需要这个类本身和其类加载其共同确认在JVM中的唯一性；</p>
<p>比如，在一个程序中，存在类加载器ALoader与BLoader，同时存在唯一一个类，top.bubuzi.App；情况如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; ALoadClass ALoader.loadClass(<span class="string">&#x27;top.bubuzi.App&#x27;</span>);</span><br><span class="line">Class&lt;?&gt; BLoadClass BLoader.loadClass(<span class="string">&#x27;top.bubuzi.App&#x27;</span>);</span><br><span class="line">System.out.println(ALoadClass == BLoadClass); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>可以看见，及时是来着同源的类，在不同加载器下，类元信息并不相等；这就实现了加载器隔离；</p>
<h2 id="双亲委派机制"><a href="#双亲委派机制" class="headerlink" title="双亲委派机制"></a>双亲委派机制</h2><p>在JAVA中提供了三种类型的系统类加载器</p>
<ul>
<li><p>启动类加载器（Bootstrap ClassLoader）</p>
<p>由C++底层实现，属于JVM核心的一部分，用于加载**${JAVA_HOME}/lib**目录下的文件，或者被-Xbootclasspath参数所指定路径中的文件，该加载器只能加载特定名称的文件，如（rt.jar），并非目录下全部文件；该加载器无法被用户直接引用；</p>
</li>
<li><p>扩展类加载器（Extension ClassLoader）</p>
<p>由<strong>sun.misc.Launcher.ExtClassLoader</strong>实现，它负责加载**${JAVA_HOME}/lib/ext**目录中的文件，或被java.ext.dirs系统变量所指定的路径中的类，开发者可以直接使用扩展类加载器；</p>
<p><strong>JDK1.8后ExtClassLoader被废弃，使用PlatformClassLoader</strong></p>
</li>
<li><p>应用程序类加载器（Application ClassLoader）</p>
<p>也称系统类加载器，由sun.misc.Launcher.AppClassLoader实现。负责加载用户类路径(Class Path)上所指定的类库，开发者可以直接使用这个类加载器。<strong>一般程序默认使用该加载器</strong></p>
</li>
</ul>
<p>应用程序都是由这3种类加载器互相配合进行加载的，如果有必要，还可以加入自己定义的类加载器。加载流程如下图所示：</p>
<p><img src="https://s2.loli.net/2022/04/28/RqfBc7j5L6GIivO.png" alt="img"></p>
<p>在JDK1.8版本以上，若代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ClassLoader classLoader = App.class.getClassLoader();</span><br><span class="line">    <span class="keyword">while</span> (classLoader!=<span class="keyword">null</span>)&#123;</span><br><span class="line">        System.out.println(classLoader);</span><br><span class="line">        classLoader = classLoader.getParent();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会出现打印：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jdk.internal.loader.ClassLoaders$AppClassLoader@2437c6dc</span><br><span class="line">jdk.internal.loader.ClassLoaders$PlatformClassLoader@6e8dacdf</span><br></pre></td></tr></table></figure>

<p>其中并没打印出PlatformClassLoader的父加载器<strong>启动类加载器（Bootstrap ClassLoader）</strong>，因为启动类加载器属于JVM的一部分，是无法被用户直接引用到的；</p>
<p>Java类加载层级称为：<strong>双亲委派模型</strong>。它的工作过程是：如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把这个请求委派给父类加载器去完成，每一个层次的类加载器都是如此，因此所有的加载请求最终都应该传送到顶层的启动类加载器中，只有当父加载器反馈自己无法完成这个加载请求（它的搜索范围中没有找到所需的类）时，子加载器才会尝试自己去加载。</p>
<h3 id="为什么？"><a href="#为什么？" class="headerlink" title="为什么？"></a>为什么？</h3><p>都知道java.lang.Object是java中所有类的父类，它存放在rt.jar之中，按照双亲委派模型，无论哪一个类加载器要加载这个类，最终都是委派给处于模型最顶端的启动类加载器进行加载，因此Object类在程序的各种类加载器环境中都是同一个类。试想，如果没有使用双亲委派模型，由各个类加载器自行去加载，显然，这就存在很大风险，用户完全可以恶意编写一个java.lang.Object类，然后放到ClassPath下，那系统就会出现多个Object类，Java类型体系中最基础的行为也就无法保证，应用程序也将会变得一片混乱。</p>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p>以下代码取自 <strong>JDK11</strong> 中 <strong>java.lang.ClassLoader</strong> 类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 由JVM实现的启动类加载器</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">native</span> Class&lt;?&gt; findBootstrapClass(String name);</span><br><span class="line"></span><br><span class="line">Class&lt;?&gt; findBootstrapClassOrNull(String name) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!checkName(name)) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> findBootstrapClass(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="keyword">boolean</span> resolve)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">        <span class="comment">// 判断该类是否已被加载，返回该类的类元信息</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">long</span> t0 = System.nanoTime();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 父加载器存在，调用父类加载</span></span><br><span class="line">                    c = parent.loadClass(name, <span class="keyword">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 父加载器不存在，调用启动类加载器加载</span></span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 再经历父加载和系统加载后，依旧为被正确加载类元信息</span></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line">                <span class="comment">// 调用自身的加载函数</span></span><br><span class="line">                c = findClass(name);</span><br><span class="line"></span><br><span class="line">                PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回加载类的类元信息</span></span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总得来说，类加载过程分为三个阶段：</p>
<ul>
<li>查找对应类是否加载，若加载直接返回类元；</li>
<li>若未加载，递归调用父类加载器的加载函数，直到父类为空时，再调用启动类加载器去加载；</li>
<li>若上面均未加载到类元，则使用加载器本身的加载函数去加载类元信息；</li>
</ul>
<h2 id="打破双亲委派模型"><a href="#打破双亲委派模型" class="headerlink" title="打破双亲委派模型"></a>打破双亲委派模型</h2><p>核心实现：<strong>线程上下文类加载器（Thread Context ClassLoader）</strong></p>
<p>这个类加载器可以通过<strong>java.lang.Thread</strong>类中的<strong>setContextClassLoader</strong>方法进行设置，若创建线程时还未设置，它将会从父线程中继承一个类加载器，如果全局均为配置，那么默认就是<strong>应用程序加载器（Application ClassLoader）</strong>；</p>
]]></content>
      <categories>
        <category>源码分析</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux下安装docker和docker-compose</title>
    <url>/2021/04/22/Linux%E4%B8%8B%E5%AE%89%E8%A3%85docker%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><h3 id="通过脚本安装"><a href="#通过脚本安装" class="headerlink" title="通过脚本安装"></a>通过脚本安装</h3><ul>
<li>国内一键安装 sudo curl -sSL <a href="https://get.daocloud.io/docker">https://get.daocloud.io/docker</a> | sh</li>
<li>国外一键安装 sudo curl -sSL get.docker.com | sh<h3 id="通过apt安装"><a href="#通过apt安装" class="headerlink" title="通过apt安装"></a>通过apt安装</h3>输入命令：<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install -y docker</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h3><p>安装完成后输入以下命令，若正常输出版本，则安装成功</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker version</span><br></pre></td></tr></table></figure>

<h2 id="Docker-compose安装"><a href="#Docker-compose安装" class="headerlink" title="Docker-compose安装"></a>Docker-compose安装</h2><h3 id="通过官方脚本安装"><a href="#通过官方脚本安装" class="headerlink" title="通过官方脚本安装"></a>通过官方脚本安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">$ sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>
<h3 id="使用pip安装"><a href="#使用pip安装" class="headerlink" title="使用pip安装"></a>使用pip安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get update &amp;&amp; sudo apt-get install -y python3-pip curl vim git moreutils</span><br><span class="line">$ pip3 install --upgrade pip</span><br><span class="line">$ pip install docker-compose</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>Docker-compose</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu配置软件源</title>
    <url>/2021/04/22/Ubuntu%E9%85%8D%E7%BD%AE%E8%BD%AF%E4%BB%B6%E6%BA%90/</url>
    <content><![CDATA[<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>防止修改软件源后出现问题，先将系统原有软件源备份一份。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cp /etc/apt/sources.list  /etc/apt/sources.list</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<!-- more -->
<h2 id="添加软件源"><a href="#添加软件源" class="headerlink" title="添加软件源"></a>添加软件源</h2><p>命令行输入如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure>
<p>添加阿里源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>
<p><a href="https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/">添加清华源</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预发布软件源，不建议启用</span></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-proposed main restricted universe multiverse</span></span><br></pre></td></tr></table></figure>

<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>更新软件源：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>更新软件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get upgrade </span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>docker命令全解</title>
    <url>/2021/04/22/docker%E5%91%BD%E4%BB%A4%E5%85%A8%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="Docker命令"><a href="#Docker命令" class="headerlink" title="Docker命令"></a>Docker命令</h2><h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> [OPTIONS] CONTAINER COMMAND [ARG...]</span><br></pre></td></tr></table></figure>
<h5 id="OPTIONS说明："><a href="#OPTIONS说明：" class="headerlink" title="OPTIONS说明："></a>OPTIONS说明：</h5><ul>
<li>-d: 分离模式：在后台运行</li>
<li>-i: 即使没有附加也保持STDIN 打开</li>
<li>-t: 分配一个伪终端<h5 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h5>进入某个容器的bash<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it 容器名 /bin/sh</span><br></pre></td></tr></table></figure>
<blockquote>
<p>某些情况下，/bin/sh可能换成/bin/bash或者其他内容</p>
</blockquote>
<h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4></li>
</ul>
<h3 id="search"><a href="#search" class="headerlink" title="search"></a>search</h3><h4 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h4>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>git多秘钥管理</title>
    <url>/2021/04/22/git%E5%A4%9A%E7%A7%98%E9%92%A5%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在某些情况下，我需要在一台电脑保存多个git账号。<br>例如，在公司时连接公司项目使用公司密钥，回到家写个人项目时使用自己的密钥。</p>
<span id="more"></span>

<!-- more -->

<h2 id="配置方法"><a href="#配置方法" class="headerlink" title="配置方法"></a>配置方法</h2><p>编辑配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim ~/.ssh/config</span><br></pre></td></tr></table></figure>
<p>输入以下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 自定义的host</span><br><span class="line">Host git.ibubuzi</span><br><span class="line">  # 指向 github</span><br><span class="line">  HostName github.com</span><br><span class="line">  User git</span><br><span class="line">  # 指向前面生成的ssh秘钥,地址可随意</span><br><span class="line">  IdentityFile ~&#x2F;.ssh&#x2F;git.ibubuzi&#x2F;id_rsa</span><br><span class="line">  # 指定唯一</span><br><span class="line">  IdentitiesOnly true</span><br><span class="line"># 当然可以配置多地址</span><br><span class="line">#Host host2</span><br><span class="line">#  HostName server</span><br></pre></td></tr></table></figure>

<h2 id="导入仓库"><a href="#导入仓库" class="headerlink" title="导入仓库"></a>导入仓库</h2><p>配置完成后需要修改clone地址<br>原地址如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git clone git@github.com:bubuzi&#x2F;helloworld.git</span><br></pre></td></tr></table></figure>
<p>改为配置的主机地址，如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git clone git@git.ibubuzi:bubuzi&#x2F;helloworld.git</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>京东签到脚本</title>
    <url>/2021/04/25/jd-bot%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.">
  <script id="hbeData" type="hbeData" data-hmacdigest="05ddc23583fe53ad59bab4a4127c84b38ff95db93766a22e4a965c5084b4c16a">ecbf84463b32ba9e81ba21d772d006b2d8b867dd3db6f2f55069538864986807c0d18a61783debc3866852d361b52535fcf5c6d3f291a59d18560883107dcaaacf85578bdcde7adecb6e48833a8135a53a033389a062263d4756c45c39fed74a88e857d4e041093445d3a420e0cf23cf96b52ce60f1d1f8cac6932b9ac7215edaaab1f092dd2c9fb152ab3db684e030430cab1a59c6d4bfcce735d38d26972814d32b38853659791c352cd7bb4d905d7425f8f917fac020c8d10e06535703b68111feac4817fc62ec980ddef64153ba15936bd901471bd81ad9d8fd66ea79d12205157962a03ecd7e1f699b921e7f852626ed8fcc795a67d3e96fb1c6485363e6d15f73c3346587da627a17508e0407b631a02d148d0227fbcc1acab4f5b4ffaf88b77aea2d79a00f5b83bc18a1f2e8a0bf47fe54e16e965dd497dddd87b81f68ab7cac59cf2b091733eba3126fd251194bd149f2d7a8c73deda6920cb0e92001e147ccc07dc28e79f8b954e689c36c2798aa2838736e07f40f668c935602ee950502f814fd15b75d19c1c9c888ca3a8d14be773cdd8bbca2db6239f7d6a2b9c670b55b3b8dc8d006919707bab9f10d4868ddb27c6db4be840f660cfecdd1d9ac5a8e81f7b3cbf47e9f7accf60a4b20904011dfa819db83fd31934f2a6c9fa93e008a854b336a251ad43af6981159c3209eaa0bcba23fdd2d53353aa266e8a2a600c753f1ace947afdcba5ff355d31df0ce7ff98381c0a9b04f33f9ed2520a0f72139580022508b64f22bde48b515833509c18b7e4defd5b5300a574429726836ba354940bf40e02b642b02cadef2e505d6578f05635e709682fbd215bfcc7e8234acef51e0e07f361b93261066484d399af38a494d46e57d906086961f7d3e9d35e5358b6736a55531696e8785223568bb705768f061c1c4816b041c9d4f0967f14a514f8909627057a2156a6a699fdedff1321643217b343f8b955b5479961622379420a7310c9cfaf41a459b7bcca968b8d9fba8dd95808e5bef0270243de7fb586ca77dc40d941d52c7f1507b96f6cfc9f54183d7f96aecf3dbb7776fb470ef975d495f433fbdb8f523e80e2fee38bef02c868b7743db308d3872f28f5e326cdfd209a11221b1331af76b58512624f35fa154c2d12ff92e0a28f76107e2b3eeb6c231545fb173331b068ebf4e33864d9232c630f263d32f1aab52b0a272b61c5cb57faeea5ceb23f85e6b9d7453161fb888ee9b7dce6b1d97f5a67cf7a894c444e410e157a0d425c8c9d92f1928d22632015e94eceac031457cd3761c4222d89327c3e50631bb65ea2726faf69184e7357c3e37c1bf9ac826440d471a9443785b0c6631871f5611796dccd1f7661685771ef17ea8621ce1defa97f000fb9f87a73de561d8291fa84a0283a68050224ffc5dff8dd13b8d3854ec5c5df086f9a313dcb3be84ba2df90d70ba57d30a6defe826cc41e73fadb16640cf37c9afa58643a0e0ce218de1d4d0190cff86b1c118746d65f63af26b3dfc3452275d2c6df2297884570c9f20d95a46d376afcd9531637f550e593f3baefdd0084eb18dd499bc4e59ca0b289790eecb10fce3a2534773b370c4c43ca877e7479d9f29ed01f487e19f8859a6574d55f6427ba42290aedb9de2e856e2a006ef87394e8ff81f9b0c7a70c95ea2b3693dc653940f1992806b7ba38bcb70a2f90cbea2f8ab8ba6b118540cc7781e4410abe181bfe33f9878606b6126faeced93f2ac0ea646b91de9761de79c01b61d7c153b18b8c5d7159d691b6f794e073807c2b8f3610e09e814dd8a26d4ba8aa7cdae21aa7e19e1e5b1a7fbb539a5f9e8de805abf0fa7b44c9087444599cda55e693a528a5f9aa859b35bd1b252921e5c937c1c7204a453d7eb5a00a6e6bdf57f10b186697c7e74c83f0b1dcf5cab36d9aeb7853ddafc420bdaf61ab0f922ae1110021dfca3451391ea8946e8db10fde23702e276897a3c9cb2ca07b49130c97bbc89979e7af04b7b708018ab64b53209347a6d22c1081a5bae74d14ef2554735dc729dae7a25d78838da8faccea1bdea10e89d96382ea3f055603020fb9377a6e393f2b26f81afdd50593e068c9cf42994bce04460d26206408e393a1f201ed1c27645cdbdb9f3ae920d31660677cc25f094436327fdefc9d56674952d1680fb59816166148d0edb328c8a18dae015a811c86c365810e288eb104af709c05ae3997e5a60e0c02132c0d64488e998d5622dd3ad8f35945003c10fbc6509550feedfc6f56c48ba534f0fdc6e41d72ab7e060e60dddfbd6438a775f10b68d7198590fe390f82fa1c434b742540cee05e7fc1325ffdbfb5f067d2a45af9b84f2229fe34d74d582fa85babb4b0f009b965b7fe3937e64eb79634563ec624e44424d0f9fdaf7e541ffda28559b9beb5786b9ed3502647438ef3aa97aa2ae4937138f3424f2755cc8a1b2a6c11cd04362d5b6e2f53f3f48e3f431301e4255ceeabc800afacd74959a4fc6d440284be1969c4c5ab9b6a1e5eac4a05e292dfb39abb690a95c22396c74cca5bf35b253b0d4f190c34a02aef382ed557e5840ebeda881b4cc95846302eaf7f92b5ba54da36ce0e86e3f7bef1635e65ff9320a128f89b2875d39917de3069e579960f46ef4c4ce785ec9774d33293022fbca80b537df466d8804b5aea41e2d149284de731b43b847688e71235ca0c560d432a1563fe27cb44c596295d28a78db21701fd6b4966479120515f143479f8a1320de898ceb0abfc00e941d59ed24c344dad19c60620b9d584d9c2bf1c1b9a91b32b9fbecbd512eb3ccb6721312ca89f7a84081fbf69fdadd705b9cecf8736d8fee24413ef0ccfddf8736f5f0be6a31ce1e25e27384025dbd7efed15192ddd9d3cebf4ce0bcdc640d653f12294ce6b6bec2da3ca0cee3236abff8f36011df4ecc762069271654b97373e923e1d57e9a1bcf28ac13ceb214ee1472c89c66643e3c3302f5846603b23a13473904e7b9e4d05ce90b7dbb7b469de8c2d422235e13c8c199af614c27784acb5747aa99c27e7365892386880a71fe1bc06df89ce6fb8e11d3d832d928e93708b38a13684ffd0df14ee254007d4bb5474fbf5181bf96f3072a14d4f9f79a9145c29d270ab19fb2bff282916a3ecb0ff01cbdb7750a840c539c05e308960947b4eaa231f4a875d7c20cfff3c9866705151bd81b974a6fc22741b41bb4d19f5cea9b30f419b39e87a43a7bd4767d55460113c5b53e3bdfe96645bad9b6347dc016f26a7d48d0c83f1d14125061050b738205981d62912e00e8099337c78ac27445c1740ad491d58291ce80120dde465a94de533c9533c3bcc430a2ad924b79fe7e95d4fe4378552b6ecfd860947adc8f99bcb7a0abcefcc3442da4f54ee14adbeb1f5844cf6cc8a53f1fe1b40c333d017ae5a570f292595bf0cd99697b34aee0a78cfb6160205d97c3b54e3292747051725011c8d9a165156c0f5154b0c0a5277603ca1183ea089e40f495c773ee3d65c8bc499df7dfcdfbb62b98a7edc6c74403693a54ef44b1920682d8b27e493631c3a6418f9b1e63af0e324b4ddbb8dff2ebb4e8436cbf5ea63904c6a0f503bac8cb234bd5f01a4578cdacd0d13807de6818fcd7ff6348dbf61fd88caba260ac1d2e8ac2cef177bffe044d19401a6be4e39f9f81152901e991a5f96b5ef652c2f6596ff5f1719464cbc9b0dbe06abc077e1d3776193dfd63145feb3612ab8ad1a67846f960301955c4cec127853d050d5cefc96f03953cba0862bf06173286b3f6bef0cf96d5275661180b648f61b4e5b6d1e991d5b7fe0043fc0c23d2a0da9c8d8d10acc17ac192426c84b726f8339d5c3d97c430bb2899636667a55b671fb64253e80aeaaa1933bf19c619e50fb40ffb1496211ba8522a5d9d63d4bfb38fd946ea0e5934938e97b409123b1453921dbdb6a48204125fa2f86178acb77c59cde2986d02ab1242208f0413e39edd25c1880a46e843aa086627b6418b51eed7be1cc68ad3ac81fe26a878217143c9dd5ed511e2d5caa53f55370082768ff9b9e9c37a905ae65cd3bb9b527600e0596d358ff9d42066278b9ec55427e1ab6d3bb3162c5bb3de6e82a00a17aa898719eb48275efef5ec3e47be0742e5f46c39e816dab2598d03d746fa03eb013a58cd73148378d2cc110be6215d97e9699437c497bdd7c34acc261b84fb68dcf08e9b116fd5f966d297de1aaf208318e60be28fd2e95174c0079cd7e1ab16d968f3f1799b7de9885b419440a8dc874972d62283ef2b8eab85fa1d03f44313a859b1f05c9ec5bbe931592f375a54839f3f3200635fe5a3b5ea20b401a5f4d5f9e719219550f8524796ea30370c9d2243ecd9dc03eca74c38d73991e4fc36847d98cde8cf6622fb619b72daf1932c0f21d44f15df7ff0539d7c104ec65f4a2ee0b3f64f61b1838bbd673448aabebcac79cbf61af8a0db4dd03bae0ee9b270b50215833921efd22e557d016ee781706c8010077b3484bc1d9a0af398d3e8573708a6f95e6d4ad743bed2a31ed7d23600b076f987d9e92f42972c6dce9180428d2433c617616488a2895a9a9b46f64f695af231c547d306b2b74d6ce1f06312360c84ee1ab7696683fb4fdb039342be6762739e395cfbcf1e2f14f84fedfd2d7920db78206af8241d07d384d980141680ecf84ae26329232b2cbee813da0212f7fae9ceb285611bbd195bc46311840de10b889ed97bccb849bc6064c63f9835ea1eaf4dc0189ea51784359d91c868d54fb12c6591d2b177dec2cb96e218cd38c473ff97b9b4a0e0dffd2729abc0050e751d5672e833fa3dab1fde28ff6535fbcf4fe14137f64741bdd00d21a9c9deed2149aa83b523b0b1a471971f9337eb027d6755b394a4a84b74465a91b75589af6103b841c2eb51980e2d54d1cb2c9166c7fec3f60362e45848de8b8b59f7a1fe444e9f2ac4f44d889593d103e8838ccc97e25bb127210ae32a7c64d7e641a4d11a47f216d31ad210b45b61fb71705039e4aac9dcaa422eb51faa53a2ce5884b9568c09c91871bd0e8516b0dd56254af3eb69f9cd3e6fef7fc12114d398d5d9b0e793983010ec335439292dd0fdba7af16b69413ffacee94e51a4b0e439a2f71290210e3085088b22e27505829d3c3cbe67c25496bd1bba360290ff3ab56822c181f4a24c2a27d4ef00165cf3f54d1d305fc7b1ec4259e78381a395ff8799ad2356799f6657c706cfca17c210e981a080a38e3f83c860dea7971cdbd37308a257884a4d5cca76ec019f08fe6c025fb609fb6db3bdbfec5886870fd61080dcfa84c25d2c808c2689f0d1831ecd383e995a8902453d26db9480cd51ac76e15683ef79f79ecec483481b239b27c8c474092c90d25a0806e70f3d500c009e077bb415d97ee1d5cdb4fc4333c4ad777872dd79321421f20cdfe994a61cbb2692615c23d97feb2000382fb49e57f86a3afc2b3ca7cdd64af72dc921051f404615b9aff363c5fe3d26bb140b1feb63952949bdad22b9ef3e54a3ac71bb7944f3ba84160d38871ad124fc10112358ece58f48e405a2828b0acc29fc967431cdf10adac091be181d54c479a08055244ab6a768c3f6cdd91ed4bf6deadc51788f8987052795fa6c2a09bd08b4f9f81f78fdbbe386497ebcd4e5f26469001048429d4320e0d288410dca494a6e77fd6384d3da76053562a6cf4104525fd40d7655fb58e797b7f6160ce675301757770acadac8a980d40ced49783b04e1fef0a2a90575e33c8878c7e34cb433d1f886143e0a7bea4f93be25bf52006253f0363461e013db13999b6a3abf1e1df4f5b75003b42991db7b0f33e8b61792fcd16e0d68f637d6309e2e2633df31bf05125183324f723b8d8942ae86cd521cba57b140c0d01af7b35a7624896af4262ec3e16abf9bce468843af38b01820fc960c88e807f15368b572070d2c8609d8e81162322569c0dab81660e65c34122fade011ec5dc1d6d4a31bfcfa1a409dd9641512d86d6d96a21c8c8438d31741f8b246e9c5874875e8fe6305ded03cf1658d6b0e1f43089ed9548541f6ce34db3d5b2b921b1d738d16fc9ab8f958c03ec50d3cab8bbd5bf26212f0259b7778b0723306aa8eec60ff26963243312652e2a3aca9d045546d62831d6cad05e9f33db61cc3b3a33a06201a131c160042c4da12b08847d25b35dd42a37c7b608a60448531ec1024dfaf3215b8a724c86337e618c4be07845976313a5da9a550a06f3c57a48663e28b6e9d53c47611404bb4203a5caa968d27ffe3d431b8a328cb312e7ff1b078949799265d9b365e11807a60c2e45a8c9885f3870bfcfe28797e0d4663a8426f64890f992ed696b6414c12c00428efcc95a9833dd3f1b928933f631b8418de856f11c625ade6b3b2b10244b384d46db6ab58c923abb0fb0a55e8c9c165f78d0e1eb3e7a42efc4c09ecd6d80b0b114f67f8b7aba3a30ed9f8492cb99c340e3181182ac67f6ba7133987913f2b8dba323e3338910ab128c7862530680dcdf1f17a5b8f476f9bbdbf4ef450c8bfffd08cde91ac72662f3fb006ee0f55a9dff4aaee511f07254258448ce2b38c715609a7cc6d97a6c98249711b59999a60907618cbf058c6afead7795b6a97046cbe116ef41107709c94723aa6ba962e32eb445127241d88833f79ce79d46d4b7bfe86b9eebe5eef0fbdb6e911253fa4b8a6c2542dce8033b0a090b1ef6c6d3bdbe81b2ace9b198ccbd251f8c309309417b953641ada11cfdc6093efe6b8a25f59795fb30b6ddcace9fbf415d5706640a9d6307aaf4dbe02eaca92febffe72b2d0a6338b50e138b726f558f833da57ab25ca7f1846aa943e624c88f9c434b4fe3f3089f8f9fa24bd42a909eea23fb7ac58875fe7acbb5dab6a9f57ff859a651fd24f357dd3f32b2ca64c04cf6cd71f7a8db9d14b30d94f51c25c3bc71576bd6071517f3c5dfe61632fdd1febc6bf22a69a300e48b8aefff37847932bd2f177b48f3038b37081b3bdc2edf563b5a5948f7844e56b35ba108d18376f47bc4b27d88e72cb39b6e943249b0aae3981a5b4e6499043a465a239af9c140f0f267872318661c1c44001b391c24685dc4376570b28c5301989c4874b651684007bc14f99b49164c29fbb8ef5bd6723c374076d89e75d048003d49de825823e646d3dc651959044059ddc2855bb9fa0fc50863d80b55eec39c350e893b17418acef619c92a0308c2c7ca93aa1e371ff8dfbb87ce93454c3d1be9cf107da1699d01e343bd2dbaeb91470ac1a043f247ecbd91238eb7af73d3ed95b6936f976b66ec1b9886b06c374e0adda81f8ba455c6a8a4a1a32cf1e63b7b6439b6ab426460f0a10f76d054f3422fa113aea40cd378e5952949ac66a690e1e797b48d4c17424d42e257e21a655116838a4c4cbf4a61e7751827af0328e72cffd5195e5d0312aa091f2b386aa9844fdd2eb96a6d33c4a33ad21a5deb1fb41ab42b96846bd9e8965c100cf0d7f4a53a52a1562ca20601f2361fd6ff697922ef8ea1213ba3ca8a3286d0a8c1f52679f48b429975ac8d63051a9615e814a76a5838b1e1030c1b3f96f43a7ffb13385410b55f1d0a13e6598da4a5a8997cbf44a571e9e6cf255ea5234abc4f7be18e705ec6fb97251b81b0ed1657033421129ff16689f2ee14b4ee35db46c9308ef1f9b3b8c3c1a7df279408c1a76f31a18659e16fa56707331c899bd5f448c266ca94bb46ca76f9b60108351b049ba46d5be193142d126bdf20c8ae72e79e384d4a10cec751a5b67cd1ec3cb1e65691cec81765a6feac2cc0c48f9675513d8b40628b374e1d9f8a9706fef9467bc929e503e65b521f08fb6e8be7716c4046489201549db80d54afa97d6a1ca92ccfd6d20d2bf83f336f36661eeb79d8b6b26ecd36b1e45db9a3ecb1f44cf30820939a60cd41dd0e849baa9afb8a80e9de546887429988b6c20689a22ea93f73da6b43110a7d334d97409d9d2397982adf904e99fec7ed44a03721b823035ce2cfc5b4f722ca403433de7fbd02ffb64fd2ed00bb8dd614eda061e58bfb8ece52ce9a8568b3b7cbd512adcc5faa65ab4c306e3b5f2fb7c1242be13525d903f69f70079efb264b53732c5839cba9a13ba36b107da37005da89052c8df5bb81ad9f85dec17d5d828c7b76108b828baf6ab94343e032ac9167c67c7031bd501f0696d10a7651bf3476da3c40c7bb05d97e88fdb6f6e4f85a2c0667619ad6df0e854cd258d55ab5837de028739a325e652b301c899f46f24b8571951f61d1c378e21e0cb2f96b4e496367ee33450bdc5a93c6010ce124496c62ed9962aeb83c9bced024b38a0cbc30b684090f7f16cdcf130a1cdfeb19c7913581a854357797e8bf605d8847b5d7327d6c2611adb2db3d492d0cd401e6775ad6cbadb3677fb414a6a4003077bf8f7bae919703f075d6011f8acec080090892b9f1f26103e02c44218fd36701c1fb28a926a9124f141f5f5d89d7f49411ec53606e99d7174ecd59c4e497fa6871688c5f672c7dc98c46754da295daf45b808ec66b0aa8e2c35874d09b6d55d6f644e4c304cf54c838eadebd229811af861065b6153654f29ead96e5a24ddde9c3594af504e49949af27746bf911b38438de9e8952c1acdca8c71b2710e79af1d8e430e8a411a95a2d9d88dade66665d516d802aaa37023e2dc2c369413f8600745c6b764f9b24c0a1507c4573d1d34aa2b046d372f8b76d71b74167b51a0cf5dae632ec6c8cad6a7bac0af0d7b906c8044549c306717c54564751d787da3d6cbf77050b99123b30da64233e78a9d644b7ccdaeb1c733cc4ebdfe66db4c8e5d521549c97b04d417a2c414fc6547a4d000d77ec5d91e802dbf8c71f9907949abe7c1d7813d805531f8fdcdb56857bbc5018d4bb6d5a2acb0271edbba131dde36f368bb85e73849f7bbe433b37a1ee176fb234ee9adbae1f9d0b826df0facb52d8e30b6fed0a2cee034265b057a0f368d9faa40fa0d6356be45dcca384c6bc3834a9788772bbde2a08b9c37f6f471d6ec27ecd3ccc94486f836bb831d27c2eae4ced05b0a6183b9277987db0e43efb4f1175de6977f0459811586fc47a754af80af06a3107715bdaecfba4dea6c57fb5439f32a7080ccc55c09df999b37a89793fb2ee38b8d057b3f51404f909c10fb2925f343be5a7acf022f9ffafd28b6a9dd25811c8df453495b2e6f23ce29564f8f5fed5e57648417a9c21a5f4b94b33411d08745929ff3262bf83ac92cbdae2e5a3381e69821a058e1f7c2467715df2e5d5696734a4326a4936efa0b83b0af5711cc2f225dcd8da2039d46c3686280f5d20f2c67354527bbe50a3498d3abc59110631e4861739078c4ba1f594fbfd241fa19e0371edd6510f15c910e09b8c04a07fc3f0acfb4c5b61cab648dcba690983603587744020ddf57826e93d614ef03fc5d50db5bb06bc8921f0fe85390e088ad43307bd39f6305e4f14999c99ff232e3b2c75b0d51b6452fc25ed6151fe577534068b2686c44b15a99693be38d4adab97f304607c7d7bb71dce8b784c8b7984ceb770800a0dfa3d7a104dbcb5be51e0843229369b27b3b828c338f4d0c9177efcf97ce1e3acfcd818d7a24b4d273e322a02787a4f8816067804b25a265d2ff6c78a16c6aac1a36b608b871d104ece243ad84ec625ee21e68509257b09b76354d98fed54f88587de515345997f2f2255037f0db42bcc868e04d1a9f6ad0d1b3093b3ed0cf937ceffa89c2c66a6d77e9500658d719a2f822c8f04f539f26aa6619b933ccd25fd02e184d604166e02ce09ce4858d46c5f17d2d01ff9d645fce1419add3d5b330c704a686512e8026e100f95eebf5ae86218d2bc3ca69d606a81252910cd04bdf8a5304f2d16973132116892b7245de36c3f3ef6d8dd192e2bee9c1579b6da5b81890de41fedcd31cbabafdba4341e0637abc630d85f452c44a788fc8f6ff06a8820d611b7f1a2c3111cfd55045da619c811c1507a989cc1a93ba0373bdaa97a632174c48c4834f9d74c8aae70e31bb17fa15f1040b993754daf1d32bb59a0e724521eac915759978618bf72097ba9a8a9941fd448b9ee621c816a6f61adc6b789d8b3640a5a438c3382af28f0c32128e22ba32d3d7360ed4642ca34459a2ed5a9972affb925e7444c3c6436794de2d873fca0113fabbf0bf8117f04681c05a6b71a6f94553968b7d919048b6b197ff05f3056827d1176bfc8fab028a91e2385b53adedb03e4ef404359a23a0b6ef27dc407e56454b2f5b88ad467e7de1e90fe5185b15c4aed3604fe594b33ef9692ba2a026d614ebea77c86e685dd2720a5f883a0a03c1be317bb7c168497b31ec3e7ca04f97fcfb0622263182f7ab1e898e2d9091ffd46df4c636c5f4411e44c0cd8f4b32426c1ad418280e36680ee79ddaa82106738028a51eaa7d11f294f46ab59b09218ea0fb2a30c7ef1ebf5173e06a17848d3c7e8e046551b5138132462678d5040e7f2a2e2b32bc2069e13382fbc716351f2d0ff1133a7bc785e74d5a90fe7ce054707f5d6075c554c6be71f164d2ff4fba2f9417da72771f9fb6af0be885293cf2ee40b8f0d59701390b543db4cc58da7059ffa455ef0049569acde442a6b01ade210b53a817721e256c457e098ab5070546ad938d023b8d9c9c62930fe61375eb2f3aeb95cc804d2f6d30e7804f50dd3b237677e34d7e1e15350a083a9e094681917c113e8e76568606685aff5ad64abca17190cb42b71b8040ebd8e8566591b0a4f5ee33bc97430f0932787c227bd7186813d57ffa20e7e61030929bec057b2e66b149e53cd1ed2b1741cebe8b1f5f7ab3aa268b6c8af42a0a731c3d7aea8c9eee7ef94b18d75375df4302c7de705fbe39771bd589b8b1d11af9c385a5ce464f1b85f88c7ffb0d631360ecc6008153cc451844739d8d860aa84db2d87fc416fd03ad47693b48a511c76dfce8ac2c4a3a898e746a04f54fec7438b9e938c18e457200b84b170629fa2efa9565735ceb0a08f5182c32a1e1175c5bf56ff7f734197176157fcfb76c9959573e1a3b69f712b8a845e9239a1b32f1b4fca06e0b489414226e93ae3d4cda44ba3449909c539bca2874942ec5f6df7f14a8985ba5d19174e9e2c39d132310711796b22aee5985444e664e40a150e0224beae9aa20a465943c4ee1540a5d25e392fbacafe0a8099d8e823cb5f86b94660956868f30abdc3d76a07a71f4c90e87c6a722ed4d9712502e2ae30969365624884994687908c80c7c63ad311ec076e634d6597c1ed81b1f6af088ddd63e5961bb428b5a5e1589fb5ee45664de6c0d424d3778b261db8911cd32875879c843f132cd4c2215501e4fcdeed31d0006c7efaddfebc792d8b313044b6c34df54b085feaf9109e94adb2bd8a76ac1d6e3d9ca0795abfa8cdd5bdcfccc4de2937dcd0ea1ff9f2aa65f4458975a0ce93c471d015a983380d4d9c9cac109418b10ee3bfb9703c5aae3e3c54b7033458db27cad558172df0d5510219a821c5ad493860ccb0aeb44794b7527de63c0b854a264999c9a9895b5b122e941b3e34f0926880cba9743a786c21dfecd7319a7ef88070c4a503a285b757a2e4604e0e5235a08ef4d3edf6b963066f608272f9dcbdd693da2823910acb0e1c9684f713c0befbf27fc4439b46500c885b8c682badeca741349c42693f82ed88fa72bd867dcc6acd348b319384f91e3c58aee28bcb00f7fbe2de2b9d7ac26d7cc8ab4eefe575e9f08597349febd86b78b6c469a566d82386734d601eaab072f2079703e83547690a3a744810b7b9c632535847b131cf461b7da885dac98f4ae00b3b6279b6fe84fc7ba793a2a931e1d4c04cd9140a0266444785339368db9055d94b0367577e3765560601f34faad1538739d12c89f13cb10abe44319aca0f781356b2121bc2dd10d39e2fe9d1ca12ef0ba8096b5736dc7d90506bf6bfcfe550318c76e836ca47e7f35d3defb34e7ff52983f0be3cb386637047561bc19bcfe6d6059840f15db8c8134f093b6b254e635855337fc6480d296914a60bd29bf815b72f68d6b6e9bc1adeaf10edd4f3701e73d348be24b1f9439ca57732e7c5f5d90fea768cc235ed6d37f7a9db21c80b0f2c4e56db1a9f5c60ac174008bdac8e6e4b71ae86a4f872a158f473c13768ff156f99bf184d2a7f85da4d2009a159f581065a01c451a31f56c89c698be553ab5318b5a082083b62227515a000ecdffe1a663b0634f72a17dbc89792db111aa3133a127583c7aa415b3ae79896e976fbb3bcd74fd3f3a95caed4bd5cc2c4ac32906ac0f74a5b1787489926a2c533e198254abc9a3bb4e21c5f5d77fb08a3cfbf6256f0408f3fca2e0b33c238248b59b4600acd92d217603a6a75c6e5576b0bd2e0a8395b43c05e76f059a164bb0b9d6fa3a016811cf01cd0002b70371e6267165fc47e1647a3da10a111db47ff80d60c1d75bb0b3d28208ce62afcc9d6e1907115581ad926d8d68ddec911071c83811d50c4184a8fcecbc86697a5c62c88b7f86d0b5ba7c364535a9b8ef37d1aa65e0b6b6858e962dd5efbdd4ace8b142ef242600a8683634a30b4b13443447f6aa68b229b8483e09eabcca4bb333ccd8dcd224398d51465039451c331a232c06ac1d4868c4779c202026bd2aaee370333859dc0428e4f44164e6e84de963861f53812c4d3d110645719e8cfc715e6f83ef88f456e1ab79ac5fb2a7c0372447a00e07bab1ab124f28a6aa4f553c455f891a5f5b470c1faed0a461b332cb28846ceb05b1bc0cf2788a8aff7e1c723192bac48c12f805481dd5a0d20a6330570e69f118d4793212d3fee8ce33ea3bd73e48b19b73f70c27a985ea686e8fd9847e806f23aec553bdc923d6346ddc5dfba1af7929ebeb488f5b42ae93f78b0f4d5a6c7f606207323149b5eba3827601b03656fb87377f4eb87d879a4443b57fe2b602284782249e693c1b6474e2eb64c965be4d4ad2d09a54aac3cb20522c3726632e9a3aac974f0a6fb7450bf13497cebf51f556476de0f53e9ae92ac39a5efe1d51c5df49a3245dc9d08edf133638c7d23eebb2a41682a42a6b564f2361a58355fdaa0c803b424434fa05c392660a619c34107d8875548ff990553019e66def69d4efadf955ec37315d5afd8b5c8d4f80a6eb318005c5bc8ed48ded4cdfd16eb1c58c4645bd42bd4b5cb852c9173b85cd430b0865d9348b5f2a24567705b18118b8053e315cde83b5f0c7398501164e009e1868df145eae546ca43c9de2e9d6ce1b5e028d6cb914df6fdcc4c4e1f2356f63d65adc06ca0ec5e4ea0ad34c8a2063f959c9bf76dff0bdb084609ea02ee09e1a61be255f48ad01abbb89387d1ddb9cea625d07f9fb43ed4635ef4a56f654c7e6e76b3b7d276cf39607733f63325e11d09e8b5b29840b7d6e942b24f5584d04ca41e05a48aa74bc21328a5f9a1bc211ea758b5c34a07997f6fda028043fc5b382e1e0ae45c29a1d9ee566921d51923a414e6b42f0e5539cdd9cb71aa16859d85792751b2459183c66ddb1e2a62bd2b587889ef57f9d16c659c5d65943bcd377d787647c6c30035bbf091d32c63ba0771d7991248dc9da38392f5e4ccb7b14c4598259c0536db30a8f9170289a6b9746fcd1c57d4a4d9229ff0ce421e34184bfc1fa24c07f4541d7d1cc5133559dbcf3f6ab398bd1d2d0191eff3f788c3e251a7abe9239445717bac078b2066d13d01eb84828f5357d39985fce53ab5c5288e3439235a4a0cfb8c3c95d0f749db7f9037d5f066ccfc794c6062466cd82200388729495cf96bcc8259fc67f75f574ffedf7163594cc3fa8625e1f93484a973660c00f5ff078d3b8eda88b40e13ec84d8876ef723aec3f9ca30e8840d321ab24b8ec2a946ac5a425aeda91ecf10dc36f02328a91fc1f5c79bef1a1b1a1daf71b80a1aa5d26eba9a14e6077b44890a81a8106fe8f93ba633ffc218251d62bd78424563b158007e00de2b1bad6bb91bb9d3fcb2cc69493729fb43d3c72d9618060d22c00408457f62bd474391dd0cb84271535c527c1aeee4696f974fc855cc034e2a3a6b15b93d00308c96aadf07d9e3eaaea3650d7f8fed76c931a953fe9abcfbe4c278cdc617f2ebe9cb0b7e1002c2cce20a57033e56a10434c14b16f6da6baa7ab40f065c2f51fbc17a19ab96df9332dd0ea20d7808df1b7e6a67f1cc40c7fbe45be4a05d31ab81d3298974425dc3bdbcc143881b5ff9121f4dc24de34fedfc80f26caf9b4b7d012c37903dabbafbd078ad3f5b8a39cfda832ba5beb27aba09f787c0ca36d3601c55979273c71e67124b63b00706d31fb45d3140f68a66e10a8010c426ca3ebeca5eb52c9052d9b265177cbb6f37ba320afa9c2e3535996562d616cc159454459559b08b13564a69b85e9aafc951bde46998c37ba6a7f0ad6422eb9feb78f1c75bb03e759751b5da881b87b804f1da4950b3439fa1a6a2479a378f7b9e419df1a66187575f4651974a3c001d08dcb332b894b661c94e961f983f5a8559cd3a3013fe4239c1218226479e8af692db91e953ba02eb4d1ab5ccb7d58064f91142139042b4fb0d0ed226db94e9b495cc9f07b1b94f0862b1a5d734c67488a4c607f1cd868b27e4026508ff8de859616141066ae189142a05d378804c0892184275025650c506010dc18c42e9552f9060140d67078b1d377d01cb8385dbd02577c7f10526687db9748a5c491b6662a5a5331ff712daf6c128821d1af89543bc5de12c5be7bbbed4ac45019471fcdb18d8c9c8f4d109fc4d901bc7f93b4a14fcd6dd948700c1107f983898517af72509083d786f11cf04f79a5d3c0da47f79fa5f2679a05306c6e136d9ccaaafe487846a25ac51761276fad1682f5775c35f88578922fe215ea0b21ca287f8db8501ea12dfcbb54fd93766f0977b99c06f65239aa58c45ad061c27f5cffd7abf1e8469dca1a096b99f0308c53d7e266c4c0c8be4d3ec8c2a1a08f07054b8424defb12204909acda8f750c6719e9e9652dbf0e69f551f8fc8bacbf3df331b7d368978f343185142b6fa72f42c589eb65fe16891473bd4e6dba9afed63006f0534e64697016792e0fb06abdd743b57b75c4e08dd9f6ec6bcaade9af512f12cb3049ad203bd010c5976662c51099668acde80a8b55633578eb9266027082cf1dccec441aeddd59d7b3aaf47b85f8818e353ceea12a36da2b0f9a8ce6d7b8fa5bf2cd99327343d1e7fe2b4f9e332e7830c2b95cca4afa3e416c53e865a12d599572af2f3762a0b59a7ae998dc758dc5b7971bf7f4ee469de2313637469304237de49526fbe70ca9731119ce08d45c5642194b0060e81fd850abf3c0d9d8957ae148fd94e73fc545c13b785a716268e5d161d34542e7657cc2501f1ab942f9a2e872be0fd41685a5b5a6e65005bb7fdc680852152a8db6f9af94dd342ec73f737210c942d405734e0a2b09a0d169c62d2d3123cb84e13b40d53e5b05d2ebc1fd2c357d439fd8010b3ec6845879f9e8c652aff69ffce9e9ea0016185e26845584dd8117367afc1b3d48995199a1089d2378a02fa53e9b6a163187c67b82823846bec5e61b196cd634d4d349d63d82c378b08135d5fab5b894e80af10823381ab5956459cca8a87f4ab2241eee2103ba61591ff764f2296770f4ed37675e5ff8c07a8ae2dce22307c530910ed73fb003fa0159486b8aac47275ebab6e0499a5f2129f2d06e5352525236932e33bfbb0f6323e91e57e3cc4a96b8523e5885dc27fd28abf0c599b3fa83c4354741e76f6ea9c3b7cb9d035bca8b3dc9ee264b97f6b94f82ba034f0b913bdac20277d9ba5a8f26c611432e0d0228192bcf4311618039ffca7495c9c5d0fbb2365e4a5ba98f2ac88100cfac6512a336bf623c8a3532a05065cb7e9af5df974c10409fe3f61ede1426c1abb115e0b38c34751f5b10707fc6b43ac3c0563395834de9db5798fb947928a77294d0e5db6cc35a73e8b8602b7dca4d2d9130c38c285c875dd94cb34714b9a8f7a99db8281ef0b4e5dc9f7fb97f25726d4f38790f1899a39fe36652f79f3ea768dafe369808902752eec3630b07fc0970e210e45d054850ba307cf2cc60efbd8769e994f110d8c208322ba2ccba871054419496823749fa3f0ca3aa3ce019934e8b15123f9df99661af134d8e6efc7e69046ee4934ec3ffa94036c7496fae065676c7668c47816b3c3af65023a2ea0674ae3e421fb7e7743514b48c9b67cc8c3a8bceb49bb460243c2cda2acf0c849c2991d2c48db9e5f0202084748eb20e8afebebe35cc5fb83d9a6354fdb71ecdd32c57308213eb542750e02a001be9fbe9c0ae8dbe921c27bb260afdc6f90b58693efe3904f8bb97c59cbe844e48264bc54d0c30807349d4d2db84d7f516cbcb3594742614f2590d027625c2dab0c55eb4ba71bcadd0c37cdc207611e0b25f784bd3b2b81b9a3875bd280be57700aca9286cdd5ec2193f404d15e2aba491c867c869e8bcaade5557f856eb0d6c1dac77756433f9adf2a81148bb5152ade3032fb640ff9c0886bc84dee5bf2f018b821e4c73abb495570123cfa203f9c89f8cae2314fc652ece34f03fa317d3c11ef50bd9e49ac160b081dce8d932b16f965a0b462e654ead0fba86a82dc9e129f5d65c449104d5da3f23fca7b44061fc08426da4aaa96ac8bec5b3a7725be86aa4d4e6d09eee80a1084ea16834467ede07668d27b4e5f3e172ecb44f6ce642c3f555ed0d1a56570d6c149dcfd1a36b23bbee6b436e58fb6727355a9a6035e815dbf66c890fb6f135dd7dc9af5db7f88063ddfadf88ceffc393b2d5beb1698a8cfee6d132ad4daef6737bd29e1a75e6b38d9662bb85c64ce6c5c9d44333b51f124bbe67f85a564b5bdf5df424ab953202a4ad71c27eb652e5ff6826d9022da5cef00aaac3da5d97214377928e83b58783613ab4b323d8b96a611cd7003122898d486cd5cae6e84a26974daa510f3246bd3acd926e37fedd6520cb40935a3ae01d5a783c4f5d28ffd62a706a2bbaf6a1d46d53a1545f2426dcc795ef9df9a1a7e7c35ca5b93f4cb9b199ffe5d93fbf80c20672d7fc68c4b98472f6f466e1056933a543f32bef129e8bba480d413c148062c2140a478207269b1a5669eb24a9035c69693f71f854597eccf0418612813d904865cbaae1ec2da10bdc8d4a38a33448a4544a8c5ec082c209c84b754b9a43d6508a56c62c3e2ce61f009541fefc1c8b054e80beda73470829508f3303c900c259aa028b4d7cf83484f1daea0260f32aa42e7219f066433c979b90b1ae0418b51818c4ab50bb937cd52e696947eb7fe2a762a7093d74408bd26691fe1d298628498250929e6ad6900e182138e4d25f2eed638c22363a96d00dade61f41989c8bbed5345dee7f8f3f5060b0790394895508dd00a90a06126b541e6292fb1889921df4c9920557dce16d71e4499a317c8f0ac339858afe02d59875e87bdba4ddf2274f814a2c4f2e3776e5e01f97a6454271f5948af35206e2baee116a62b5ac30e8ed77ea85fc9c061bb01234b3e9251bcb89052c211a4cd1aaeb01f7a9fb0fc1228f735ed932b247296dc17f026488339480b0216108684b93b9b05b6719c70d86dd0d75c2bd8b645562014de51a604ab733696236e413bf189dc3cabf5a15994a77696a05be7dcd79f09f533b95f7f3b9533ebdbaef4bcf5190260331159076f2c7ced4e75e644139ac0a6a21106fcb687adb2da45d8f0a7cde54396812a9c4034097af56a591fafbc1afa012f16bcdb93b220cb01f52dbc4db9e85ea7e456bd112b65a4241fd8d957bcc3b2fbf9a3eeeb97ec0c32d8d87adfcc4a15314fcb72ae70b534dbb6327e037e828bd5517c27c9b63568f2ac2b3e23058679188a4c9005d8eeac9453ee40587290b1ad96d2d658ec52645f5b79c9c1ab1bf222882dbca1128bb5b2355e10f6e476da02a946a063dbccd1edeb84c4cc05603c81335db6f8b475112f0423b2e8a4aac32d0bd0d387fc9bd3fa2f34b02656b679a37d890928ea2c7fa28949d85d2f0a38a07d54644463b5311692fc4e0104901e3adb77f39296475d855c6448a274d9663709059c7a09a39d7055cbac07756a0d27bc86451e1c57fc83433b8a2fc0b559d4af494360c2b3c7cf7e2bc2c15d87e308c85d27e4bafd994b706f2e7088a76b308f623c573943102994575d430fe97514c82f121c218dbd463ed95d9d6deabf76cf910654ebe44733c4d6b6995e69baa979a8765e81b5afb3e6da75ba36de61760e880f9b18c93891d602bed97987a9ac3436dbfb2392c5a7a6c198ec55771a420181487778391112a7607589e862ced1a8781a26f16446dd4bfc663c83744db765c8c9d46935023c7294ea615b0b0703e06aa7c3e6623a352ea995e7c1d8ed44167234f662a74cfef6ba46798c8742c4a335f18649e47ffe904dcd94ea30d1931861263bea6557a7ce64ce4247207c55aa77aa6f43dd41af0f7ace4989ce2b42bb724de85169c9111bb9b158fdd055e215d9c869a5b841bfbc3ff0b408e562b9cbdb3c3f41aa11a4c6ecf650e8b16747eb435c5f9897d703bf53571343e97cd0306706fe7d7f35bdae170e055016c83a31fdc4c6f77d58c74b5131874ff0ce3ec5dc25ae8ab98c8d8b2bfc09abc3115334207c2536b6860f55831aa811d8fb7836bf5a322cf1affe6acdcceead19d4bfc4daa2038f38d8ccd0daabf62799374a4509f3f893d9f0d4f022692330d1ad036dfd9ad1bbd8477df1b4bf267d419c0dd4e10b4405b3075d9fde24394966d9e5e947295935ea0061e9e24745f2b659ca09e77bfc44896a2366370e685b639f7ec773445b729063e462eafe4fa5b635f53b26185164dcfd1a561f614a6592f0e9f748d7e88a04f52d4de81d8f113fc3aabfdc78c4e4bc25b1cb36174a62dd0301803bfb441ac0914e8a52cd8b020719df3dea1917b796b57ae2bc68168bb5e3602bec50448993f14ccb7b0d9ccc82019e70bc923aab2bc7f419cfe4ddbf66f93504e17ddfe6b96496ccb3e522785b02d50e5fa3634bcf2d153b88ae957c57c9f9769ed2d941f0c9f508762d2fede04698ee1bb4ee2588dccd268c158af0f0bb0a5218ae0147b48b5e155d3be9123eb0ae25d17ab08ec807f45eb21bf13cd033c1a4f3a408eba1b73bf684af07a8342b2e5c2d424947af144736517f063337d31d3b01f292ce0f1ef3ffec6027b019e465b16fa209d9d75811a068bdeda333c5</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">您好, 这里需要密码.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>日常</category>
      </categories>
      <tags>
        <tag>脚本</tag>
      </tags>
  </entry>
  <entry>
    <title>git操作</title>
    <url>/2021/05/18/git%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h2 id="git基础"><a href="#git基础" class="headerlink" title="git基础"></a>git基础</h2><p>学习git，首先要了解几个概念</p>
<p><img src="https://i.loli.net/2021/05/18/cprAeDzadNG2u4T.jpg" alt="img"></p>
<ul>
<li>working dir 这个是工作区，我们一般都处在工作区中</li>
<li>index 这个是缓存区，可以临时保存你的改动</li>
<li>HEAD 指向你最新提交的结果(上图没显示)</li>
<li>哈希号 可以认为是某次提交的身份证号码(上图没显示)</li>
<li>local repository : 本地仓库</li>
<li>remote repository:远程仓库</li>
</ul>
<h2 id="安装初始化git"><a href="#安装初始化git" class="headerlink" title="安装初始化git"></a>安装初始化git</h2><p>正常我们都是在Linux下开发和使用git，如果在windows和苹果下开发，请自行百度</p>
<p>安装git</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sudo apt-get install git </span></span><br><span class="line"><span class="comment">#sudo apt-get install git-doc git-svn git-email git-gui gitk</span></span><br><span class="line">初始化git</span><br><span class="line"></span><br><span class="line">ssh-keygen <span class="comment">#生成git key 默认在.ssh目录下</span></span><br><span class="line">git init <span class="comment"># 在当前目录新建一个Git代码库</span></span><br><span class="line">git init [project-name] <span class="comment"># 新建一个目录，将其初始化为Git代码库</span></span><br><span class="line">git <span class="built_in">clone</span> [url]<span class="comment"># 下载一个项目和它的整个代码历史</span></span><br><span class="line">git config --list<span class="comment"># 显示当前的Git配置</span></span><br><span class="line">git config -e [--global]<span class="comment"># 编辑Git配置文件</span></span><br><span class="line"><span class="comment"># 设置提交代码时的用户信息</span></span><br><span class="line">git config --global user.email <span class="string">&quot;you@example.com&quot;</span></span><br><span class="line">git config --global user.name <span class="string">&quot;Your Name&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="代码提交相关命令"><a href="#代码提交相关命令" class="headerlink" title="代码提交相关命令"></a>代码提交相关命令</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/username/repo name.git <span class="comment"># 从远程仓库下载代码</span></span><br><span class="line">git status . <span class="comment"># 查看当前工作区的修改</span></span><br><span class="line">git add * <span class="comment"># 跟踪新文件</span></span><br><span class="line">git add -u [path] <span class="comment"># 添加[指定路径下]已跟踪文件</span></span><br><span class="line"></span><br><span class="line">rm *&amp;git rm * <span class="comment"># 移除文件</span></span><br><span class="line">git rm -f * <span class="comment"># 移除文件</span></span><br><span class="line">git rm --cached * <span class="comment"># 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class="line">git mv file_from file_to <span class="comment"># 重命名跟踪文件</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">log</span> <span class="comment"># 查看提交记录</span></span><br><span class="line"></span><br><span class="line">git commit <span class="comment"># 提交更新    </span></span><br><span class="line">git commit [file1] [file2] ... <span class="comment"># 提交指定文件    </span></span><br><span class="line">git commit -m <span class="string">&#x27;message&#x27;</span></span><br><span class="line">git commit -a <span class="comment"># 跳过使用暂存区域，把所有已经跟踪过的文件暂存起来一并提交</span></span><br><span class="line">git commit --amend<span class="comment">#修改最后一次提交</span></span><br><span class="line">git commit -v <span class="comment"># 提交时显示所有diff信息</span></span><br><span class="line"></span><br><span class="line">git reset HEAD *<span class="comment">#取消已经暂存的文件</span></span><br><span class="line">git reset --mixed HEAD *<span class="comment">#同上</span></span><br><span class="line">git reset --soft HEAD *<span class="comment">#重置到指定状态，不会修改索引区和工作树</span></span><br><span class="line">git reset --hard HEAD *<span class="comment">#重置到指定状态，会修改索引区和工作树</span></span><br><span class="line">git reset -- files<span class="comment">#重置index区文件</span></span><br><span class="line"></span><br><span class="line">git revert HEAD <span class="comment">#撤销前一次操作</span></span><br><span class="line">git revert HEAD~ <span class="comment">#撤销前前一次操作</span></span><br><span class="line">git revert commit <span class="comment">## 撤销指定操作</span></span><br><span class="line"></span><br><span class="line">git checkout -- file<span class="comment">#取消对文件的修改(从暂存区——覆盖worktree file)</span></span><br><span class="line">git checkout branch|tag|commit -- file_name<span class="comment">#从仓库取出file覆盖当前分支</span></span><br><span class="line">git checkout -- .<span class="comment">#从暂存区取出文件覆盖工作区</span></span><br><span class="line"></span><br><span class="line">git diff file <span class="comment">#查看指定文件的差异</span></span><br><span class="line">git diff --<span class="built_in">stat</span> <span class="comment">#查看简单的diff结果</span></span><br><span class="line">git diff <span class="comment">#比较Worktree和Index之间的差异</span></span><br><span class="line">git diff --cached <span class="comment">#比较Index和HEAD之间的差异</span></span><br><span class="line">git diff HEAD <span class="comment">#比较Worktree和HEAD之间的差异</span></span><br><span class="line">git diff branch <span class="comment">#比较Worktree和branch之间的差异</span></span><br><span class="line">git diff branch1 branch2 <span class="comment">#比较两次分支之间的差异</span></span><br><span class="line">git diff commit commit <span class="comment">#比较两次提交之间的差异</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">log</span> --grep=aplog <span class="comment">#查找关键字aplog</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">log</span> <span class="comment">#查看最近的提交日志</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=oneline <span class="comment">#单行显示提交日志</span></span><br><span class="line">git <span class="built_in">log</span> --graph <span class="comment"># 图形化显示</span></span><br><span class="line">git <span class="built_in">log</span> --abbrev-commit <span class="comment"># 显示log id的缩写</span></span><br><span class="line">git <span class="built_in">log</span> -num <span class="comment">#显示第几条log(倒数)</span></span><br><span class="line">git <span class="built_in">log</span> --<span class="built_in">stat</span> <span class="comment"># 显示commit历史，以及每次commit发生变更的文件</span></span><br><span class="line">git <span class="built_in">log</span> --follow [file] <span class="comment"># 显示某个文件的版本历史，包括文件改名</span></span><br><span class="line">git <span class="built_in">log</span> -p [file] <span class="comment"># 显示指定文件相关的每一次diff</span></span><br><span class="line">git <span class="built_in">log</span> --oneline <span class="comment">#只用一行显示每次的提交包含哈希号和commit内容 </span></span><br><span class="line"></span><br><span class="line">git stash <span class="comment">#将工作区现场(已跟踪文件)储藏起来，等以后恢复后继续工作。</span></span><br><span class="line">git stash list <span class="comment">#查看保存的工作现场</span></span><br><span class="line">git stash apply <span class="comment">#恢复工作现场</span></span><br><span class="line">git stash drop <span class="comment">#删除stash内容</span></span><br><span class="line">git stash pop <span class="comment">#恢复的同时直接删除stash内容 最好不要这么干，除非你下次确认不会再使用缓存数据</span></span><br><span class="line">git stash apply stash@&#123;0&#125; <span class="comment">#恢复指定的工作现场，当你保存了不只一份工作现场时。</span></span><br></pre></td></tr></table></figure>

<h2 id="分支操作命令相关"><a href="#分支操作命令相关" class="headerlink" title="分支操作命令相关"></a>分支操作命令相关</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git branch <span class="comment">#列出本地分支</span></span><br><span class="line">git branch -r<span class="comment">#列出远端分支 为了方便查看，前面会有一个*号显示</span></span><br><span class="line">git branch -a<span class="comment">#列出所有分支</span></span><br><span class="line">git branch -v<span class="comment">#查看各个分支最后一个提交对象的信息</span></span><br><span class="line">git branch --merge<span class="comment">#查看已经合并到当前分支的分支</span></span><br><span class="line">git branch --no-merge<span class="comment">#查看为合并到当前分支的分支</span></span><br><span class="line">git branch <span class="built_in">test</span><span class="comment">#新建test分支</span></span><br><span class="line">git branch branch [branch|commit|tag] <span class="comment"># 从指定位置出新建分支</span></span><br><span class="line">git branch --track branch remote-branch <span class="comment"># 新建一个分支，与指定的远程分支建立追踪关系</span></span><br><span class="line">git branch -m old new <span class="comment">#重命名分支</span></span><br><span class="line">git branch -d <span class="built_in">test</span> <span class="comment">#删除test分支</span></span><br><span class="line">git branch -D <span class="built_in">test</span> <span class="comment">#强制删除test分支 可以多分支同时删除</span></span><br><span class="line">git branch --set-upstream dev origin/dev <span class="comment">#将本地dev分支与远程dev分支之间建立链接</span></span><br><span class="line"></span><br><span class="line">git checkout <span class="built_in">test</span><span class="comment">#切换到test分支</span></span><br><span class="line">git checkout -b <span class="built_in">test</span><span class="comment">#新建+切换到test分支</span></span><br><span class="line">git checkout -b <span class="built_in">test</span> dev<span class="comment">#基于dev新建test分支，并切换</span></span><br><span class="line"></span><br><span class="line">git merge <span class="built_in">test</span><span class="comment">#将test分支合并到当前分支</span></span><br><span class="line">git merge --squash <span class="built_in">test</span> <span class="comment">## 合并压缩，将test上的commit压缩为一条</span></span><br><span class="line"></span><br><span class="line">git cherry-pick commit <span class="comment">#拣选合并，将commit合并到当前分支，比如我们之前在dev分支下做了一个修改，然后切换到master下面来，同步了最新的代码，可以通过cherry-pick把之前的提交同步过来</span></span><br><span class="line">git cherry-pick -n commit <span class="comment">#拣选多个提交，合并完后可以继续拣选下一个提交</span></span><br><span class="line"></span><br><span class="line">git rebase master<span class="comment">#将master分之上超前的提交，变基到当前分支</span></span><br><span class="line">git rebase --onto master 169a6 <span class="comment">#限制回滚范围，rebase当前分支从169a6以后的提交</span></span><br><span class="line">git rebase --interactive <span class="comment">#交互模式    </span></span><br><span class="line">git rebase --<span class="built_in">continue</span><span class="comment"># 处理完冲突继续合并    </span></span><br><span class="line">git rebase --skip<span class="comment"># 跳过    </span></span><br><span class="line">git rebase --abort<span class="comment"># 取消合并</span></span><br></pre></td></tr></table></figure>

<h2 id="远程分支相关命令"><a href="#远程分支相关命令" class="headerlink" title="远程分支相关命令"></a>远程分支相关命令</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git fetch origin remotebranch[:localbranch]<span class="comment"># 从远端拉去分支[到本地指定分支]</span></span><br><span class="line">git merge origin/branch<span class="comment">#合并远端上指定分支</span></span><br><span class="line">git pull origin remotebranch:localbranch<span class="comment"># 拉去远端分支到本地分支</span></span><br><span class="line">git push origin branch<span class="comment">#将当前分支，推送到远端上指定分支</span></span><br><span class="line">git push origin localbranch:remotebranch<span class="comment">#推送本地指定分支，到远端上指定分支</span></span><br><span class="line">git push origin :remotebranch <span class="comment"># 删除远端指定分支</span></span><br><span class="line">git push origin remotebranch --delete <span class="comment"># 删除远程分支</span></span><br><span class="line">git branch -dr branch <span class="comment"># 删除本地和远程分支</span></span><br><span class="line">git checkout -b [--track] <span class="built_in">test</span> origin/dev<span class="comment">#基于远端dev分支，新建本地test分支[同时设置跟踪]</span></span><br></pre></td></tr></table></figure>

<h2 id="git远程源"><a href="#git远程源" class="headerlink" title="git远程源"></a>git远程源</h2><p>git是一个分布式代码管理工具，所以可以支持多个仓库，在git里，服务器上的仓库在本地称之为remote。</p>
<p>个人开发时，多源用的可能不多，但多源其实非常有用。</p>
<p>正常的时候，我们在一个远程仓库作为本地代码仓库的源，但是有时候我们远程仓库的地址改变了，本地不管提交还是拉取代码都会出错，这时候就需要更新源。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git remote add origin1 git@github.com:weiqifa/demo.git <span class="comment">#添加源</span></span><br><span class="line">git remote<span class="comment">#显示全部源</span></span><br><span class="line">git remote -v<span class="comment">#显示全部源+详细信息</span></span><br><span class="line">git remote rename origin1 origin2<span class="comment">#重命名</span></span><br><span class="line">git remote rm origin<span class="comment">#删除</span></span><br><span class="line">git remote show origin<span class="comment">#查看指定源的全部信息</span></span><br></pre></td></tr></table></figure>

<h2 id="想清楚了再使用的命令"><a href="#想清楚了再使用的命令" class="headerlink" title="想清楚了再使用的命令"></a>想清楚了再使用的命令</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git push-f origin master<span class="comment">#强制提交，这个命令你领导估计也不知道你干嘛了，当然你爽了，别人就瞎逼了</span></span><br></pre></td></tr></table></figure>

<h2 id="同步其他分支的某个文件"><a href="#同步其他分支的某个文件" class="headerlink" title="同步其他分支的某个文件"></a>同步其他分支的某个文件</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git show main:scripts/resource_tool&gt;scripts/resource_tool</span><br></pre></td></tr></table></figure>

<p>把main分支下的resource_tool 同步到当前分支下</p>
<h2 id="打包项目源码命令相关"><a href="#打包项目源码命令相关" class="headerlink" title="打包项目源码命令相关"></a>打包项目源码命令相关</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> –bare kernel/ *<span class="comment">#这样生成kernel.git 这里会包含.git文件夹*</span></span><br><span class="line"></span><br><span class="line">*git <span class="built_in">clone</span> kernel.git/ <span class="comment">#这样来解包*</span></span><br></pre></td></tr></table></figure>

<h2 id="打补丁命令相关"><a href="#打补丁命令相关" class="headerlink" title="打补丁命令相关"></a>打补丁命令相关</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git diff ./ &gt; *.patch</span><br><span class="line">patch -p1 </span><br></pre></td></tr></table></figure>

<h2 id="查看历史分支图"><a href="#查看历史分支图" class="headerlink" title="查看历史分支图"></a>查看历史分支图</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> –graph –all</span><br></pre></td></tr></table></figure>

<h2 id="学会查找资料"><a href="#学会查找资料" class="headerlink" title="学会查找资料"></a>学会查找资料</h2><p>总结的命令不一定会都用到，但是学会如何查找资料解决自己的问题非常关键，很多时候我们提交可能提示出错，很多的时候都是分支跟master有冲突，或者从错误日志上可以看出问题，多动动脑子，很快就可以解决了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">help</span> commit <span class="comment">#查看commit命令的帮助信息</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/05/18/VbOd27WLAF9xr8c.png" alt="img"></p>
]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>spring项目中使用统一异常处理</title>
    <url>/2022/01/26/spring%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>spring项目中的后端表单验证</title>
    <url>/2022/01/25/spring%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%90%8E%E7%AB%AF%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81/</url>
    <content><![CDATA[<h1 id="解决Spring项目中后端表单数据验证功能"><a href="#解决Spring项目中后端表单数据验证功能" class="headerlink" title="解决Spring项目中后端表单数据验证功能"></a>解决Spring项目中后端表单数据验证功能</h1><h2 id="JSR303"><a href="#JSR303" class="headerlink" title="JSR303"></a>JSR303</h2><p>采用JSR303库中提供的效验注解</p>
<p><img src="https://s2.loli.net/2022/01/25/w8LXS4QV91JGPOa.png" alt="image-20220125232949284"></p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><h4 id="在bean的字段添加对应的校验注解-Valid"><a href="#在bean的字段添加对应的校验注解-Valid" class="headerlink" title="在bean的字段添加对应的校验注解(@Valid)"></a>在bean的字段添加对应的校验注解(@Valid)</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Valid</span> // 添加注解确定该对象需要校验</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@RequestBody</span> BrandEntity brand)</span></span>&#123;</span><br><span class="line">        brandService.save(brand);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="返回数据"><a href="#返回数据" class="headerlink" title="返回数据"></a>返回数据</h3><p>当再次进行非法请求时就会返回如下</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;2022-01-25T15:36:50.377+0000&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;status&quot;</span>: <span class="number">400</span>,</span><br><span class="line">	<span class="attr">&quot;error&quot;</span>: <span class="string">&quot;Bad Request&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;errors&quot;</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">				<span class="string">&quot;NotBlank.brandEntity.name&quot;</span>,</span><br><span class="line">				<span class="string">&quot;NotBlank.name&quot;</span>,</span><br><span class="line">				<span class="string">&quot;NotBlank.java.lang.String&quot;</span>,</span><br><span class="line">				<span class="string">&quot;NotBlank&quot;</span></span><br><span class="line">			],</span><br><span class="line">			<span class="attr">&quot;arguments&quot;</span>: [</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">						<span class="string">&quot;brandEntity.name&quot;</span>,</span><br><span class="line">						<span class="string">&quot;name&quot;</span></span><br><span class="line">					],</span><br><span class="line">					<span class="attr">&quot;arguments&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">					<span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;code&quot;</span>: <span class="string">&quot;name&quot;</span></span><br><span class="line">				&#125;</span><br><span class="line">			],</span><br><span class="line">			<span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;不能为空&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;objectName&quot;</span>: <span class="string">&quot;brandEntity&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;field&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;rejectedValue&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;bindingFailure&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">			<span class="attr">&quot;code&quot;</span>: <span class="string">&quot;NotBlank&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Validation failed for object=&#x27;brandEntity&#x27;. Error count: 1&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/product/brand/save&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义响应"><a href="#自定义响应" class="headerlink" title="自定义响应"></a>自定义响应</h3><p>jsr默认响应不符合业务规范，将接口改为以下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Valid</span> // 添加注解确定该对象需要校验</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@RequestBody</span> BrandEntity brand, </span></span></span><br><span class="line"><span class="function"><span class="params">	BindingResult result	// 紧跟校验对象</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 校验时是否出错</span></span><br><span class="line">        <span class="keyword">if</span>(result.hasErrors())&#123;</span><br><span class="line">            Map&lt;String, String&gt; errMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            <span class="comment">// 获取全部校验错误，取出放入返回值内进行响应</span></span><br><span class="line">            result.getFieldErrors().forEach(error-&gt;&#123;</span><br><span class="line">                String field = error.getField();</span><br><span class="line">                String message = error.getDefaultMessage();</span><br><span class="line">                errMap.put(field,message);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="number">400</span>,<span class="string">&quot;非法参数请求&quot;</span>).put(<span class="string">&quot;data&quot;</span>,errMap);</span><br><span class="line">        &#125;</span><br><span class="line">		brandService.save(brand);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中BindingResult必须紧跟需要校验的对象</p>
<p>此时非法请求响应如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;非法参数请求&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;code&quot;</span>: <span class="number">400</span>,</span><br><span class="line">	<span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;品牌名不能为空&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义正则校验"><a href="#自定义正则校验" class="headerlink" title="自定义正则校验"></a>自定义正则校验</h3><p>在需要正则效验的字段上使用**@Pattern**注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// other field.....</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;/[a-zA-Z]$&quot;, message = &quot;检索首字母必须是一个字母&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String firstLetter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="隐藏问题"><a href="#隐藏问题" class="headerlink" title="隐藏问题"></a>隐藏问题</h3><p>单个注解下，在不添加非空校验时，只有提交才会进行校验</p>
<p>所以若要保证字段安全校验，必须配合使用非空校验</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@NotBlank(message = &quot;检索首字母不能为空&quot;)</span></span><br><span class="line"><span class="meta">@Pattern(regexp = &quot;/[a-zA-Z]$&quot;, message = &quot;检索首字母必须是一个字母&quot;)</span></span><br><span class="line"><span class="comment">// other...</span></span><br><span class="line"><span class="keyword">private</span> String firstLetter;</span><br></pre></td></tr></table></figure>

<h2 id="分组校验"><a href="#分组校验" class="headerlink" title="分组校验"></a>分组校验</h2><p>应对不同业务下的校验规则</p>
<p>比如当新增时，需要输入全部数据，但是当修改时，只需要提交对应修改后的字段</p>
<p>此时就需要进行分组校验</p>
<h3 id="流程-1"><a href="#流程-1" class="headerlink" title="流程"></a>流程</h3><h4 id="修改注解"><a href="#修改注解" class="headerlink" title="修改注解"></a>修改注解</h4><p>采用 <strong>JSR303</strong> 注解的的 <strong>groups</strong> 属性进行分组校验，</p>
<p>groups要求传入Class对象，</p>
<p>如下，其中AddGroup和UpdateGroup为空接口即可；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@NotBlank(message = &quot;品牌名不能为空&quot;,groups = &#123;AddGroup.class,UpdateGroup.class&#125;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AddGroup</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UpdateGroup</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不同group表示在不同情况下需要校验</p>
<blockquote>
<p>注意：当使用group校验后，其他未添加分组的校验将会失效；为保证所有校验正常运行，确保其添加正确分组；</p>
</blockquote>
<p>不同注解和分组可以组合使用，如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@NotBlank(groups = &#123;AddGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@Pattern(regexp = &quot;/[a-zA-Z]$&quot;, message = &quot;检索首字母必须是一个字母&quot;,groups = &#123;AddGroup.class,UpdateGroup.class&#125;)</span></span><br><span class="line"><span class="keyword">private</span> String firstLetter;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当在AddGroup新增模式下时同时触发@NotBlank和@Pattern校验，但在UpdateGroup更新模式下时只会触发@Pattern校验</p>
</blockquote>
<h4 id="修改controller"><a href="#修改controller" class="headerlink" title="修改controller"></a>修改controller</h4><p>将此前的 <strong>@Valid</strong> 注解修改为 <strong>@Validated</strong> 注解，并填入触发的校验组 <strong>AddGroup</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Validated(AddGroup.class)</span> </span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@RequestBody</span> BrandEntity brand</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>&#123;</span><br><span class="line">    brandService.save(brand);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>汇编指令</title>
    <url>/2021/05/17/%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h2><h3 id="16位寄存器"><a href="#16位寄存器" class="headerlink" title="16位寄存器"></a>16位寄存器</h3><ul>
<li>AX: accumulator, 累加寄存器</li>
<li>CX: counter, 计数寄存器</li>
<li>DX: data, 数据寄存器</li>
<li>BX: base, 基址寄存器</li>
<li>SP: stack pointer, 栈指针寄存器</li>
<li>BP: base pointer, 基址指针寄存器</li>
<li>SI: source index, 源变址寄存器</li>
<li>DI: destination index, 目的变址寄存器</li>
</ul>
<h3 id="8位寄存器"><a href="#8位寄存器" class="headerlink" title="8位寄存器"></a>8位寄存器</h3><ul>
<li><p>AL: 累加寄存器低位</p>
</li>
<li><p>CL: 计数寄存器低位</p>
</li>
<li><p>DL: 数据寄存器低位</p>
</li>
<li><p>BL: 基址寄存器低位</p>
</li>
<li><p>AH: 累加寄存器高位</p>
</li>
<li><p>CH: 计数寄存器高位</p>
</li>
<li><p>DH: 数据寄存器高位</p>
</li>
<li><p>BH: 基址寄存器高位</p>
</li>
</ul>
<h3 id="32位寄存器"><a href="#32位寄存器" class="headerlink" title="32位寄存器"></a>32位寄存器</h3><p>EAX, ECX, EDX, EBX, ESP, EBP, ESI, EDI</p>
<p>在16位寄存器的指令前加E即可表示32位寄存器, 这个字母E来源于英文单词 “Extend”;</p>
<p>虽说EAX是一个32位寄存器, 但是他的高位即没有名字也没有编号, , 也就是说, 虽然我们可以吧EAX作为两个16位寄存器使用, 但只有低十六位用起来方便, 如果我们需要使用高16位时, 需要将高十六位移位至低十六;</p>
<h3 id="段寄存器"><a href="#段寄存器" class="headerlink" title="段寄存器"></a>段寄存器</h3><ul>
<li>ES: 附加段寄存器 ( extra segment )</li>
<li>CS: 代码段寄存器 ( code segment )</li>
<li>SS: 栈段寄存器 ( stack segment )</li>
<li>DS: 数据段寄存器 ( data segment )</li>
<li>FS: 附加段寄存器 ( extra segment )</li>
<li>GS: 附加段寄存器 ( extra segment )</li>
</ul>
<h2 id="DB"><a href="#DB" class="headerlink" title="DB"></a>DB</h2><p>db是”data byte”的缩写, 指向文件中写入一个字节</p>
<p>db a, b, c;</p>
<p>写入a, b, c至文件</p>
<p>db 后可以接字符串, 会自动查询字符集存入对应的字节;</p>
<h2 id="RESB"><a href="#RESB" class="headerlink" title="RESB"></a>RESB</h2><p>resb是”reserve byte”的缩写,     </p>
<p>如果想在地址中空出10个字节, 可以写</p>
<p>RESB 10;</p>
<p>这样就会写入10个为0的字节</p>
<p>RESB 0x1fe-$</p>
<p>这里的$值当前代码行的的字节数,</p>
<p>在执行中, resb会先用0x1fe减去当前代码行数, 然后继续写入空字节</p>
<h2 id="DW"><a href="#DW" class="headerlink" title="DW"></a>DW</h2><p>dw是”data word”的缩写, 在计算机中 word一般值十六位的意思,</p>
<p>即写入16字节的数据</p>
<p>使用同DB</p>
<h2 id="DD"><a href="#DD" class="headerlink" title="DD"></a>DD</h2><p>dw是”data dounle-word”的缩写</p>
<p>即写入32字节的数据</p>
<p>使用同DB</p>
<h2 id="MOV"><a href="#MOV" class="headerlink" title="MOV"></a>MOV</h2><p>mov是”move”的缩写, 表示赋值\</p>
<p>MOV AX,0 表示AX=0</p>
<h2 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h2><p>add 是加法指令,</p>
<p>add SI,1 等于”SI=SI+1”</p>
<h2 id="CMP"><a href="#CMP" class="headerlink" title="CMP"></a>CMP</h2><p>cmp 是比较指令</p>
<p>cmp AL,3 表示将AL中的值取出来与3做比较</p>
<h2 id="JE"><a href="#JE" class="headerlink" title="JE"></a>JE</h2><p>je是”jump if equal”的缩写</p>
<p>je是条件跳转语句. 如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CMP AL,0</span><br><span class="line"></span><br><span class="line">JE fin</span><br></pre></td></tr></table></figure>

<p>相当于c语言的</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( AL == <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">goto</span> fin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="INT"><a href="#INT" class="headerlink" title="INT"></a>INT</h2><p>int是”interrupt”的缩写, 表示中断的意思</p>
<h2 id="HLT"><a href="#HLT" class="headerlink" title="HLT"></a>HLT</h2><p>hlt是”halt”的缩写, 表示停止</p>
<p>让cpu进入休眠状态, 受到外部输入后重新激活</p>
<h2 id="JC"><a href="#JC" class="headerlink" title="JC"></a>JC</h2><p>jc是”jump if carry”的缩写, 表示如果进位标识位是1时就跳转</p>
]]></content>
      <categories>
        <category>汇编</category>
      </categories>
      <tags>
        <tag>汇编</tag>
      </tags>
  </entry>
  <entry>
    <title>区块链笔记</title>
    <url>/2021/05/16/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="什么是区块链？"><a href="#什么是区块链？" class="headerlink" title="什么是区块链？"></a>什么是区块链？</h2><p>区块链是一个信息技术领域的术语。从本质上讲，它是一个共享数据库，存储于其中的数据或信息，具有<strong>“去中心化”</strong>、<strong>“不可伪造”</strong>、<strong>“全程留痕”</strong>、<strong>“可以追溯”</strong>、<strong>“公开透明”</strong>、<strong>“集体维护”</strong>等特征。基于这些特征，区块链技术奠定了坚实的“信任”基础，创造了可靠的“合作”机制，具有广阔的运用前景。</p>
<blockquote>
<p>以上说明来自百度百科</p>
</blockquote>
]]></content>
      <categories>
        <category>区块链</category>
      </categories>
      <tags>
        <tag>区块链</tag>
      </tags>
  </entry>
  <entry>
    <title>常用js函数</title>
    <url>/2021/04/25/%E5%B8%B8%E7%94%A8js%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h3 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h3><p><strong>检查一个元素是否被聚焦</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> hasFocus = <span class="function">(<span class="params">ele</span>) =&gt;</span> ele === <span class="built_in">document</span>.activeElement</span><br></pre></td></tr></table></figure>

<p><strong>获取一个元素的所有兄弟元素</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> siblings = <span class="function">(<span class="params">ele</span>) =&gt;</span>   .slice.call(ele.parentNode.children).filter(<span class="function">(<span class="params">child</span>) =&gt;</span> child !== ele);</span><br></pre></td></tr></table></figure>

<p><strong>获取选中文本</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getSelectedText = <span class="function">() =&gt;</span> <span class="built_in">window</span>.getSelection().toString();</span><br></pre></td></tr></table></figure>

<p><strong>回到上一页</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">history.back();<span class="comment">// Orhistory.go(-1);</span></span><br></pre></td></tr></table></figure>

<p><strong>清除所有 cookies</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cookies = <span class="built_in">document</span>.cookie.split(<span class="string">&#x27;;&#x27;</span>).map(<span class="function">(<span class="params">item</span>) =&gt;</span> item.split(<span class="string">&#x27;=&#x27;</span>)).reduce(<span class="function">(<span class="params">acc, [k, v]</span>) =&gt;</span> (acc[k.trim().replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)] = v) &amp;&amp; acc, &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>将 cookie 转换为对象</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cookies = <span class="built_in">document</span>.cookie.split(<span class="string">&#x27;;&#x27;</span>).map(<span class="function">(<span class="params">item</span>) =&gt;</span> item.split(<span class="string">&#x27;=&#x27;</span>)).reduce(<span class="function">(<span class="params">acc, [k, v]</span>) =&gt;</span> (acc[k.trim().replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)] = v) &amp;&amp; acc, &#123;&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p><strong>比较两个数组</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// `a` 和 `b` 都是数组const isEqual = (a, b) =&gt; JSON.stringify(a) === JSON.stringify(b);// 或者const isEqual = (a, b) =&gt; a.length === b.length &amp;&amp;   a.every((v, i) =&gt; v === b[i]);// 事例isEqual([1, 2, 3], [1, 2, 3]); // trueisEqual([1, 2, 3], [1, &#x27;2&#x27;, 3]); // false</span></span><br></pre></td></tr></table></figure>

<p><strong>将对象数组转换为单个对象</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> toObject = <span class="function">(<span class="params">arr, key</span>) =&gt;</span> arr.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> (&#123; ...a, [b[key]]: b &#125;), &#123;&#125;);</span><br><span class="line"><span class="comment">// Or</span></span><br><span class="line"><span class="keyword">const</span> toObject = <span class="function">(<span class="params">arr, key</span>) =&gt;</span> <span class="built_in">Object</span>.fromEntries(arr.map(<span class="function">(<span class="params">it</span>) =&gt;</span> [it[key], it]));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事例</span></span><br><span class="line">toObject(</span><br><span class="line">[&#123; <span class="attr">id</span>: <span class="string">&#x27;1&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;Alpha&#x27;</span>, <span class="attr">gender</span>: <span class="string">&#x27;Male&#x27;</span> &#125;,</span><br><span class="line">&#123; <span class="attr">id</span>: <span class="string">&#x27;2&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;Bravo&#x27;</span>, <span class="attr">gender</span>: <span class="string">&#x27;Male&#x27;</span> &#125;,</span><br><span class="line">&#123; <span class="attr">id</span>: <span class="string">&#x27;3&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;Charlie&#x27;</span>, <span class="attr">gender</span>: <span class="string">&#x27;Female&#x27;</span> &#125;]</span><br><span class="line">,<span class="string">&#x27;id&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">/*&#123;</span></span><br><span class="line"><span class="comment">&#x27;1&#x27;: &#123; id: &#x27;1&#x27;, name: &#x27;Alpha&#x27;, gender: &#x27;Male&#x27; &#125;,</span></span><br><span class="line"><span class="comment">&#x27;2&#x27;: &#123; id: &#x27;2&#x27;, name: &#x27;Bravo&#x27;, gender: &#x27;Male&#x27; &#125;,</span></span><br><span class="line"><span class="comment">&#x27;3&#x27;: &#123; id: &#x27;3&#x27;, name: &#x27;Charlie&#x27;, gender: &#x27;Female&#x27; &#125;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br></pre></td></tr></table></figure>

<p><strong>根据对象数组的属性进行计数</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> countBy </span><br><span class="line">= <span class="function">(<span class="params">arr, prop</span>) =&gt;</span> arr.reduce(<span class="function">(<span class="params">prev, curr</span>) =&gt;</span> ((prev[curr[prop]] = ++prev[curr[prop]] || <span class="number">1</span>), prev), &#123;&#125;);</span><br><span class="line"><span class="comment">// 事例</span></span><br><span class="line">countBy(</span><br><span class="line">[&#123; <span class="attr">branch</span>: <span class="string">&#x27;audi&#x27;</span>, <span class="attr">model</span>: <span class="string">&#x27;q8&#x27;</span>, <span class="attr">year</span>: <span class="string">&#x27;2019&#x27;</span> &#125;,</span><br><span class="line">&#123; <span class="attr">branch</span>: <span class="string">&#x27;audi&#x27;</span>, <span class="attr">model</span>: <span class="string">&#x27;rs7&#x27;</span>, <span class="attr">year</span>: <span class="string">&#x27;2020&#x27;</span> &#125;,</span><br><span class="line">&#123; <span class="attr">branch</span>: <span class="string">&#x27;ford&#x27;</span>, <span class="attr">model</span>: <span class="string">&#x27;mustang&#x27;</span>, <span class="attr">year</span>: <span class="string">&#x27;2019&#x27;</span> &#125;,</span><br><span class="line">&#123; <span class="attr">branch</span>: <span class="string">&#x27;ford&#x27;</span>, <span class="attr">model</span>: <span class="string">&#x27;explorer&#x27;</span>, <span class="attr">year</span>: <span class="string">&#x27;2020&#x27;</span> &#125;,</span><br><span class="line">&#123; <span class="attr">branch</span>: <span class="string">&#x27;bmw&#x27;</span>, <span class="attr">model</span>: <span class="string">&#x27;x7&#x27;</span>, <span class="attr">year</span>: <span class="string">&#x27;2020&#x27;</span> &#125;,]</span><br><span class="line">,<span class="string">&#x27;branch&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">// &#123; &#x27;audi&#x27;: 2, &#x27;ford&#x27;: 2, &#x27;bmw&#x27;: 1 &#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>检查数组是否为空</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isNotEmpty = <span class="function">(<span class="params">arr</span>) =&gt;</span> <span class="built_in">Array</span>.isArray(arr) &amp;&amp; <span class="built_in">Object</span>.keys(arr).length &gt; <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 事例</span></span><br><span class="line">isNotEmpty([]);  <span class="comment">// false</span></span><br><span class="line">isNotEmpty([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p><strong>检查多个对象是否相等</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isEqual </span><br><span class="line">    = <span class="function">(<span class="params">...objects</span>) =&gt;</span> objects.every(</span><br><span class="line">        (obj) =&gt;  <span class="built_in">JSON</span>.stringify(obj) === <span class="built_in">JSON</span>.stringify(objects[<span class="number">0</span>])</span><br><span class="line">    );</span><br><span class="line"><span class="comment">// 事例</span></span><br><span class="line"><span class="built_in">console</span>.log(isEqual( &#123; <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span> &#125;, &#123; <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span> &#125; ));     <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEqual(&#123; <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span> &#125;, &#123; <span class="attr">bar</span>: <span class="string">&#x27;foo&#x27;</span> &#125;));         <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p><strong>从对象数组中提取指定属性的值</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> pluck = <span class="function">(<span class="params">objs, property</span>) =&gt;</span> objs.map(<span class="function">(<span class="params">obj</span>) =&gt;</span> obj[property]);</span><br><span class="line"><span class="comment">// Example</span></span><br><span class="line"><span class="keyword">const</span> aa = pluck([</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">&#x27;小智&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">&#x27;大志&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">&#x27;王大志&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;,</span><br><span class="line">],</span><br><span class="line"><span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="comment">// [ &#x27;小智&#x27;, &#x27;大志&#x27;, &#x27;王大志&#x27; ]</span></span><br></pre></td></tr></table></figure>

<p><strong>反转对象的键和值</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> invert </span><br><span class="line">    = <span class="function">(<span class="params">obj</span>) =&gt;</span> <span class="built_in">Object</span>.keys(obj).reduce(</span><br><span class="line">        (res, k) =&gt; <span class="built_in">Object</span>.assign(res, &#123; [obj[k]]: k &#125;</span><br><span class="line">    ), &#123;&#125;);</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">const</span> invert </span><br><span class="line">    = <span class="function">(<span class="params">obj</span>) =&gt;</span> <span class="built_in">Object</span>.fromEntries(</span><br><span class="line">        <span class="built_in">Object</span>.entries(obj).map(<span class="function">(<span class="params">[k, v]</span>) =&gt;</span> [v, k])</span><br><span class="line">    );    </span><br><span class="line"><span class="comment">// 事例</span></span><br><span class="line">invert(&#123; <span class="attr">a</span>: <span class="string">&#x27;1&#x27;</span>, <span class="attr">b</span>: <span class="string">&#x27;2&#x27;</span>, <span class="attr">c</span>: <span class="string">&#x27;3&#x27;</span> &#125;); <span class="comment">// &#123; 1: &#x27;a&#x27;, 2: &#x27;b&#x27;, 3: &#x27;c&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>从对象中删除所有 null 和 undefined 的属性</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> removeNullUndefined = <span class="function">(<span class="params">obj</span>) =&gt;</span> </span><br><span class="line">  <span class="built_in">Object</span>.entries(obj)</span><br><span class="line">   .reduce(<span class="function">(<span class="params">a, [k, v]</span>) =&gt;</span> (v == <span class="literal">null</span> ? a : ((a[k] = v), a)), &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> removeNullUndefined = <span class="function">(<span class="params">obj</span>) =&gt;</span></span><br><span class="line">  <span class="built_in">Object</span>.entries(obj)</span><br><span class="line">  .filter(<span class="function">(<span class="params">[_, v]</span>) =&gt;</span> v != <span class="literal">null</span>)</span><br><span class="line">  .reduce(<span class="function">(<span class="params">acc, [k, v]</span>) =&gt;</span> (&#123; ...acc, [k]: v &#125;), &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> removeNullUndefined = <span class="function">(<span class="params">obj</span>) =&gt;</span> </span><br><span class="line">    <span class="built_in">Object</span>.fromEntries(<span class="built_in">Object</span>.entries(obj).filter(<span class="function">(<span class="params">[_, v]</span>) =&gt;</span> v != <span class="literal">null</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line">removeNullUndefined(&#123;</span><br><span class="line">  foo: <span class="literal">null</span>,</span><br><span class="line">  bar: <span class="literal">undefined</span>,</span><br><span class="line">  fuzz: <span class="number">42</span>&#125;</span><br><span class="line">); </span><br><span class="line"><span class="comment">// &#123; fuzz: 42 &#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>根据对象的属性对其进行排序</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.keys(obj)</span><br><span class="line">  .sort()</span><br><span class="line">  .reduce(<span class="function">(<span class="params">p, c</span>) =&gt;</span> ((p[c] = obj[c]), p), &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事例</span></span><br><span class="line"><span class="keyword">const</span> colors = &#123;</span><br><span class="line">  white: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">  black: <span class="string">&#x27;#000000&#x27;</span>,</span><br><span class="line">  red: <span class="string">&#x27;#ff0000&#x27;</span>,</span><br><span class="line">  green: <span class="string">&#x27;#008000&#x27;</span>,</span><br><span class="line">  blue: <span class="string">&#x27;#0000ff&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">sort(colors);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  black: &#x27;#000000&#x27;,</span></span><br><span class="line"><span class="comment">  blue: &#x27;#0000ff&#x27;,</span></span><br><span class="line"><span class="comment">  green: &#x27;#008000&#x27;,</span></span><br><span class="line"><span class="comment">  red: &#x27;#ff0000&#x27;,</span></span><br><span class="line"><span class="comment">  white: &#x27;#ffffff&#x27;,</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>检查一个对象是否是Promise</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isPromise = <span class="function">(<span class="params">obj</span>) =&gt;</span></span><br><span class="line">!!obj &amp;&amp; (<span class="keyword">typeof</span> obj === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> obj === <span class="string">&#x27;function&#x27;</span>) &amp;&amp; </span><br><span class="line"><span class="keyword">typeof</span> obj.then === <span class="string">&#x27;function&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>检查一个对象是否是一个数组</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isArray = <span class="function">(<span class="params">obj</span>) =&gt;</span> <span class="built_in">Array</span>.isArray(obj);</span><br></pre></td></tr></table></figure>

<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p><strong>检查路径是否是相对路径</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isRelative = <span class="function">(<span class="params">path</span>) =&gt;</span> !<span class="regexp">/^([a-z]+:)?[\\/]/i</span>.test(path);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line">isRelative(<span class="string">&#x27;/foo/bar/baz&#x27;</span>); <span class="comment">// false</span></span><br><span class="line">isRelative(<span class="string">&#x27;C:\\foo\\bar\\baz&#x27;</span>); <span class="comment">// false</span></span><br><span class="line">isRelative(<span class="string">&#x27;foo/bar/baz.txt&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">isRelative(<span class="string">&#x27;foo.md&#x27;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p><strong>将字符串的第一个字符改为小写</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> lowercaseFirst = <span class="function">(<span class="params">str</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;str.charAt(<span class="number">0</span>).toLowerCase()&#125;</span><span class="subst">$&#123;str.slice(<span class="number">1</span>)&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line">lowercaseFirst(<span class="string">&#x27;Hello World&#x27;</span>); <span class="comment">// &#x27;hello World&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>重复一个字符串</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> repeat = <span class="function">(<span class="params">str, numberOfTimes</span>) =&gt;</span> str.repeat(numberOfTimes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line">repeat(<span class="string">&#x27;ab&#x27;</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">// ababab</span></span><br></pre></td></tr></table></figure>

<h3 id="Dates"><a href="#Dates" class="headerlink" title="Dates"></a>Dates</h3><p><strong>给一个小时添加“am/pm”后缀</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// `h` is an hour number between 0 and 23</span></span><br><span class="line"><span class="keyword">const</span> suffixAmPm = <span class="function">(<span class="params">h</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;h % <span class="number">12</span> === <span class="number">0</span> ? <span class="number">12</span> : h % <span class="number">12</span>&#125;</span><span class="subst">$&#123;h &lt; <span class="number">12</span> ? <span class="string">&#x27;am&#x27;</span> : <span class="string">&#x27;pm&#x27;</span>&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line">suffixAmPm(<span class="number">0</span>); <span class="comment">// &#x27;12am&#x27;</span></span><br><span class="line">suffixAmPm(<span class="number">5</span>); <span class="comment">// &#x27;5am&#x27;</span></span><br><span class="line">suffixAmPm(<span class="number">12</span>); <span class="comment">// &#x27;12pm&#x27;</span></span><br><span class="line">suffixAmPm(<span class="number">15</span>); <span class="comment">// &#x27;3pm&#x27;</span></span><br><span class="line">suffixAmPm(<span class="number">23</span>); <span class="comment">// &#x27;11pm&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>计算两个日期之间的不同天数</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> diffDays = <span class="function">(<span class="params">date, otherDate</span>) =&gt;</span> <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.abs(date - otherDate) / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line">diffDays(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&#x27;2014-12-19&#x27;</span>), <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&#x27;2020-01-01&#x27;</span>)); <span class="comment">// 1839</span></span><br></pre></td></tr></table></figure>

<p><strong>检查日期是否有效</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isDateValid = <span class="function">(<span class="params">...val</span>) =&gt;</span> !<span class="built_in">Number</span>.isNaN(<span class="keyword">new</span> <span class="built_in">Date</span>(...val).valueOf());</span><br><span class="line"></span><br><span class="line">isDateValid(<span class="string">&quot;December 17, 1995 03:24:00&quot;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><p><strong>检查代码是否在Node.js中运行</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isNode = <span class="keyword">typeof</span> process !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; process.versions != <span class="literal">null</span> &amp;&amp; </span><br><span class="line">  process.versions.node != <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<p><strong>检查代码是否在浏览器中运行</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isBrowser = <span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">document</span> === <span class="string">&#x27;object&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>将URL参数转换为对象</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getUrlParams = <span class="function">(<span class="params">query</span>) =&gt;</span><span class="built_in">Array</span>.from(<span class="keyword">new</span>   URLSearchParams(query)).reduce(<span class="function">(<span class="params">p, [k, v]</span>) =&gt;</span> <span class="built_in">Object</span>.assign(&#123;&#125;, p, &#123; [k]: p[k]   ? (<span class="built_in">Array</span>.isArray(p[k]) ? p[k] : [p[k]]).concat(v) : v &#125;),&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line">getUrlParams(location.search); <span class="comment">// Get the parameters of the current URL</span></span><br><span class="line">getUrlParams(<span class="string">&#x27;foo=Foo&amp;bar=Bar&#x27;</span>); <span class="comment">// &#123; foo: &quot;Foo&quot;, bar: &quot;Bar&quot; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Duplicate key</span></span><br><span class="line">getUrlParams(<span class="string">&#x27;foo=Foo&amp;foo=Fuzz&amp;bar=Bar&#x27;</span>); <span class="comment">// &#123; foo: [&quot;Foo&quot;, &quot;Fuzz&quot;], bar: &quot;Bar&quot; &#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>黑暗检测模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isDarkMode = <span class="built_in">window</span>.matchMedia &amp;&amp; <span class="built_in">window</span>.matchMedia(<span class="string">&#x27;(prefers-color-scheme: dark)&#x27;</span>).matches;</span><br></pre></td></tr></table></figure>

<p><strong>拷贝到剪切板</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> copyToClipboard = <span class="function">(<span class="params">text</span>) =&gt;</span> </span><br><span class="line">  navigator.clipboard.writeText(text);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line">copyToClipboard(<span class="string">&quot;Hello World&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>将RGB转换为十六进制</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> rgbToHex = <span class="function">(<span class="params">r, g, b</span>) =&gt;</span>   <span class="string">&quot;#&quot;</span> + ((<span class="number">1</span> &lt;&lt; <span class="number">24</span>) + (r &lt;&lt; <span class="number">16</span>) + (g &lt;&lt; <span class="number">8</span>) + b).toString(<span class="number">16</span>).slice(<span class="number">1</span>);<span class="comment">// 例子rgbToHex(0, 51, 255); // #0033ff</span></span><br></pre></td></tr></table></figure>

<p><strong>生成一个随机的十六进制颜色</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> randomColor = <span class="function">() =&gt;</span> <span class="string">`#<span class="subst">$&#123;<span class="built_in">Math</span>.random().toString(<span class="number">16</span>).slice(<span class="number">2</span>, <span class="number">8</span>).padEnd(<span class="number">6</span>, <span class="string">&#x27;0&#x27;</span>)&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> randomColor = <span class="function">() =&gt;</span> <span class="string">`#<span class="subst">$&#123;(~~(<span class="built_in">Math</span>.random() * (<span class="number">1</span> &lt;&lt; <span class="number">24</span>))).toString(<span class="number">16</span>)&#125;</span>`</span>;33ff</span><br></pre></td></tr></table></figure>

<p><strong>生成随机IP地址</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> randomIp = <span class="function">() =&gt;</span> <span class="built_in">Array</span>(<span class="number">4</span>).fill(<span class="number">0</span>)</span><br><span class="line">.map(<span class="function">(<span class="params">_, i</span>) =&gt;</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">255</span>) + (i === <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>))</span><br><span class="line">.join(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line">randomIp(); <span class="comment">// 175.89.174.131</span></span><br></pre></td></tr></table></figure>

<p><strong>使用 Node crypto 模块生成随机字符串</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> randomStr = <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>).randomBytes(<span class="number">32</span>).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>按长度截取字符串</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splitByLen</span>(<span class="params">str,len</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> rev    =    []</span><br><span class="line">    <span class="keyword">let</span> reg    =    <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`.&#123;<span class="subst">$&#123;len&#125;</span>&#125;`</span>,<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    rev    = str.match(reg)</span><br><span class="line">    rev.push(str.substring(rev.join(<span class="string">&#x27;&#x27;</span>).length))</span><br><span class="line">    <span class="keyword">return</span> rev</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>谷粒学院踩坑</title>
    <url>/2022/01/20/%E8%B0%B7%E7%B2%92%E5%AD%A6%E9%99%A2%E8%B8%A9%E5%9D%91/</url>
    <content><![CDATA[<h3 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h3><h4 id="配置一样，配置中心发布的配置无法正确更新读取？"><a href="#配置一样，配置中心发布的配置无法正确更新读取？" class="headerlink" title="配置一样，配置中心发布的配置无法正确更新读取？"></a>配置一样，配置中心发布的配置无法正确更新读取？</h4><p><strong>检查项目版本</strong></p>
<p>在common项目中的pom.xml中，version改成2.1.0..1.0.RELEASE</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在其他项目中的pom.xml文件，spring-cloud.version的值，也就是springcloud的版本应改为Greenwich.SR3</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    其他变量...   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Greenwich.SR3<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>控制台输出以下就成功解决</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Located property source: CompositePropertySource &#123;name=<span class="string">&#x27;NACOS&#x27;</span>, propertySources=[NacosPropertySource &#123;name=<span class="string">&#x27;gulimall-coupon.properties&#x27;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>

<h4 id="千万注意application-yml中的缩进"><a href="#千万注意application-yml中的缩进" class="headerlink" title="千万注意application.yml中的缩进"></a>千万注意application.yml中的缩进</h4><p>坑死了，不小心多按了一个tab，检查了一个多小时，记录一下</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">      <span class="attr">gateway:</span></span><br><span class="line">        <span class="attr">routes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">query_route</span> <span class="comment"># 规则id</span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">https://baidu.com</span> <span class="comment"># 目的地址</span></span><br><span class="line">            <span class="attr">predicates:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">Query=url,</span> <span class="string">baidu</span> <span class="comment"># 断言匹配，满足就跳转到目的地址</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">qq_test</span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">https://qq.com</span></span><br><span class="line">            <span class="attr">predicates:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">Query=url,</span> <span class="string">qq</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">            <span class="attr">predicates:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br><span class="line">            <span class="attr">filters:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/renren-fast/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure>

<p>可以看见cloud和gateway之间多按了一个<strong>tab</strong>导致启动时，既不报错，也不提示，最后运行时始终无法排除问题，mark一下。</p>
<h4 id="在p62中OSS存在依赖问题"><a href="#在p62中OSS存在依赖问题" class="headerlink" title="在p62中OSS存在依赖问题"></a>在p62中OSS存在依赖问题</h4><p>报错如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Caused by: java.lang.NoSuchMethodError: com.aliyuncs.profile.DefaultProfile.getHttpClientConfig()Lcom/aliyuncs/http/HttpClientConfig;</span><br><span class="line">	at com.alibaba.cloud.context.AliCloudSdk.&lt;init&gt;(AliCloudSdk.java:<span class="number">76</span>)</span><br><span class="line">	at com.alibaba.cloud.context.edas.AliCloudEdasSdkFactory.getDefaultAliCloudEdasSdk(AliCloudEdasSdkFactory.java:<span class="number">34</span>)</span><br><span class="line">	at com.alibaba.cloud.spring.boot.context.autoconfigure.EdasContextAutoConfiguration.aliCloudEdasSdk(EdasContextAutoConfiguration.java:<span class="number">42</span>)</span><br><span class="line">	at com.alibaba.cloud.spring.boot.context.autoconfigure.EdasContextAutoConfiguration$$EnhancerBySpringCGLIB$$41856d21.CGLIB$aliCloudEdasSdk$<span class="number">0</span>(&lt;generated&gt;)</span><br><span class="line">	at com.alibaba.cloud.spring.boot.context.autoconfigure.EdasContextAutoConfiguration$$EnhancerBySpringCGLIB$$41856d21$$FastClassBySpringCGLIB$$ac01ea4e.invoke(&lt;generated&gt;)</span><br><span class="line">	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:<span class="number">244</span>)</span><br><span class="line">	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:<span class="number">363</span>)</span><br><span class="line">	at com.alibaba.cloud.spring.boot.context.autoconfigure.EdasContextAutoConfiguration$$EnhancerBySpringCGLIB$$41856d21.aliCloudEdasSdk(&lt;generated&gt;)</span><br><span class="line">	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">	at java.base/java.lang.reflect.Method.invoke(Method.java:<span class="number">566</span>)</span><br><span class="line">	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:<span class="number">154</span>)</span><br><span class="line">	... <span class="number">43</span> more</span><br></pre></td></tr></table></figure>

<p>此问题是由于版本依赖问题导致</p>
<p>修改gulimall-common模块下的pom依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-oss-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 此处排除该依赖，包默认依赖版本过低，会导致查找不到方法，引入版本为4.4.x版本 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入4.5.x版本依赖 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="MySql连接存在问题"><a href="#MySql连接存在问题" class="headerlink" title="MySql连接存在问题"></a>MySql连接存在问题</h4><p>在写代码过程中，发现mysql连接非常慢，在修改连接池无果后上网搜索，可能是由于mysql主机的dns存在问题，尝试配置以下内容，情况待定…</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>补充：</p>
<p>尝试增加mysql最大连接树解决问题</p>
<p>通过sql查询当前最大连接数</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;max_connections&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>临时修改最大连接数，mysql重启后失效</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> max_connections<span class="operator">=</span><span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p>永久修改连接数，在my.cnf文件中写入</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">1000</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>谷粒学院</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>springcloud</tag>
        <tag>nacos</tag>
      </tags>
  </entry>
  <entry>
    <title>解锁网易云灰色歌曲</title>
    <url>/2021/06/24/%E8%A7%A3%E9%94%81%E7%BD%91%E6%98%93%E4%BA%91%E7%81%B0%E8%89%B2%E6%AD%8C%E6%9B%B2/</url>
    <content><![CDATA[<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ul>
<li>git</li>
<li>nodejs</li>
<li>网易云音乐</li>
</ul>
<h2 id="拉取仓库"><a href="#拉取仓库" class="headerlink" title="拉取仓库"></a>拉取仓库</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone -b enhanced git@github.com:DoveBoy/FixUnblockNeteaseMusic.git</span><br></pre></td></tr></table></figure>

<p>我这里仓库位置在D:\unlockNeteaseMusic</p>
<h2 id="编写WShell脚本"><a href="#编写WShell脚本" class="headerlink" title="编写WShell脚本"></a>编写WShell脚本</h2><h5 id="新建记事本-后缀改为vbs"><a href="#新建记事本-后缀改为vbs" class="headerlink" title="新建记事本,后缀改为vbs"></a>新建记事本,后缀改为vbs</h5><p><img src="https://i.loli.net/2021/06/24/WrCFSfdxjqcDipY.png" alt="image-20210624094038073"></p>
<h5 id="在文件中写入以下内容"><a href="#在文件中写入以下内容" class="headerlink" title="在文件中写入以下内容"></a>在文件中写入以下内容</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Dim WShell</span><br><span class="line">set WShell = CreateObject(&quot;WScript.Shell&quot;)</span><br><span class="line"></span><br><span class="line">WShell.Run &quot;cmd.exe /c node  D:\unlockNeteaseMusic\app.js -p 10010&quot; , 0</span><br><span class="line">WShell.Run &quot;&quot;&quot;D:/Program Files (x86)/Netease/CloudMusic/cloudmusic.exe&quot;&quot;&quot;</span><br><span class="line">Set WShell = Nothing</span><br></pre></td></tr></table></figure>

<p>其中<strong>D:\unlockNeteaseMusic\app.js</strong>是我的本地仓库地址</p>
<p><strong>D:/Program Files (x86)/Netease/CloudMusic/cloudmusic.exe</strong>是我的网易云音乐程序地址</p>
<p>不清楚的老铁可以右键快捷方式图标点击属性查看</p>
<h3 id="后续调整"><a href="#后续调整" class="headerlink" title="后续调整"></a>后续调整</h3><p>保存脚本后右击脚本, 新建快捷方式</p>
<p><img src="https://i.loli.net/2021/06/24/W3huBpHPU4cZiXo.png" alt="image-20210624094444244"></p>
<p>是不是觉得有点丑?</p>
<p><img src="https://i.loli.net/2021/06/24/orwfmXZFTW3jYGz.png" alt="image-20210624094531173"></p>
<p>没有关系, 我们再右键图标, 点击属性, 点击更换图标, 再点击浏览</p>
<p><img src="https://i.loli.net/2021/06/24/VJrMqKxdmhFWaUo.png" alt="image-20210624094645552"></p>
<p><img src="https://i.loli.net/2021/06/24/XpEAKd6tkfJOYw1.png" alt="image-20210624094723270"></p>
<p>没有网易云的软件图标怎么办?</p>
<p>没有关系, 我们可以直接选中网易云的应用程序即可</p>
<p><img src="https://i.loli.net/2021/06/24/HNh6vLABTydk2Zo.png" alt="image-20210624094816632"></p>
<p><img src="https://i.loli.net/2021/06/24/RtlP1qXEwO9xnfL.png" alt="image-20210624094829017"></p>
<p><img src="https://i.loli.net/2021/06/24/ZS2Pr8oUCset1FK.png" alt="image-20210624094850172"></p>
<p>再改一下图标名称就完成了<img src="https://i.loli.net/2021/06/24/63lOWP9tqMjkKpf.png" alt="image-20210624094918299"></p>
<p>哦, 对了, 还有最重要的一步, 还需要配置网易云音乐,</p>
<p>打开网易云设置页面后, 找到代理选项, 主机填入127.0.0.1或者localhost都可以, 端口则看你的WShell脚本的内容了</p>
<p>如<strong>WShell.Run “cmd.exe /c node  D:\unlockNeteaseMusic\app.js -p 10010” , 0</strong>中的10010表示软件启动在10010端口, 当然你可以手动修改, 不过网易云里面也要跟着修改哦 ^_^</p>
<p><img src="https://i.loli.net/2021/06/24/Qkmd9Yue2xnFfKp.png" alt="image-20210624095019374"></p>
<p>到此, 教程结束</p>
<h2 id="补充一下docker"><a href="#补充一下docker" class="headerlink" title="补充一下docker"></a>补充一下docker</h2><p>有朋友说需要docker-compose的配置<br>我打包了一份, 现在你只需要创建一个空文件夹, 在里面新建一个docker-compose.yml文件<br>在文件中写入以下内容</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">unlock:</span></span><br><span class="line">  <span class="attr">container_name:</span> <span class="string">wyypojie</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">bubuzi/unblock_netease_music:v1</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">NODE_ENV:</span> <span class="string">production</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10086</span><span class="string">:8080</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10087</span><span class="string">:8081</span></span><br></pre></td></tr></table></figure>

<p>之后在运行一下命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker-compose up -d</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>生活</tag>
      </tags>
  </entry>
  <entry>
    <title>跨语言跨平台RPC</title>
    <url>/2022/07/21/%E8%B7%A8%E8%AF%AD%E8%A8%80%E8%B7%A8%E5%B9%B3%E5%8F%B0RPC/</url>
    <content><![CDATA[<h1 id="跨语言跨平台RPC"><a href="#跨语言跨平台RPC" class="headerlink" title="跨语言跨平台RPC"></a>跨语言跨平台RPC</h1><h2 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h2><p>本文使用<strong>apache-thrift:0.12.0</strong>版本</p>
<p>C# .net framework:4.6.1</p>
<p>jdk: 11</p>
<p>Java后台框架使用spring boot</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="下载必须"><a href="#下载必须" class="headerlink" title="下载必须"></a>下载必须</h3><p>**<a href="https://archive.apache.org/dist/thrift/0.12.0/thrift-0.12.0.exe">thrift</a>**工具</p>
<h3 id="C-安装包依赖"><a href="#C-安装包依赖" class="headerlink" title="C#安装包依赖"></a>C#安装包依赖</h3><p>使用NuGet包管理工具，下载安装对应的thrift的包</p>
<p><img src="https://s2.loli.net/2022/08/09/p4BLTZYR97KOjwW.png" alt="image-20220721171654528"></p>
<h3 id="java导入maven依赖"><a href="#java导入maven依赖" class="headerlink" title="java导入maven依赖"></a>java导入maven依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.thrift<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>libthrift<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="编写thrift-idl-文件"><a href="#编写thrift-idl-文件" class="headerlink" title="编写thrift -idl 文件"></a>编写thrift -idl 文件</h2><p>在安装目录编写一份**.thrift**后缀的文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">namespace csharp bubuzi.Rpc</span><br><span class="line">namespace java bubuzi.Rpc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">typedef i32 int</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct People</span><br><span class="line">&#123;</span><br><span class="line">1: int ID;</span><br><span class="line">2: string Name;</span><br><span class="line">3: i16 Age;</span><br><span class="line">4: list&lt;i32&gt; onelist;</span><br><span class="line">5: set&lt;string&gt; oneSet;</span><br><span class="line">6: map&lt;i32,string&gt; oneset;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service HelloService</span><br><span class="line">&#123;</span><br><span class="line"> void SetPeople(1: People people1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service GuidGenService</span><br><span class="line">&#123;</span><br><span class="line">  string getGuid(1:i32 id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>详细语法可参考<a href="https://thrift.apache.org/">官网</a></p>
<h2 id="生成代码"><a href="#生成代码" class="headerlink" title="生成代码"></a>生成代码</h2><p>打开命令控制台</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">thrift-0.12.0.exe -r -gen java rpc.thrift # 生成java代码</span><br><span class="line">thrift-0.12.0.exe -r -gen csharp rpc.thrift # 生成c#代码</span><br></pre></td></tr></table></figure>

<p>生成代码后，会在路径中生成gen-csharp和gen-java文件夹，内部就是生成的代码</p>
<h2 id="应用启动"><a href="#应用启动" class="headerlink" title="应用启动"></a>应用启动</h2><h3 id="C-客户端调用"><a href="#C-客户端调用" class="headerlink" title="C# 客户端调用"></a>C# 客户端调用</h3><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 指定连接主机与端口</span></span><br><span class="line">TTransport framedTransport  = <span class="keyword">new</span> TSocket(<span class="string">&quot;localhost&quot;</span>, <span class="number">9001</span>);</span><br><span class="line"><span class="comment">// 注意连接协议，客户端与服务的必须保持一致</span></span><br><span class="line">TCompactProtocol compactProtocol = <span class="keyword">new</span> TCompactProtocol(framedTransport);</span><br><span class="line"><span class="comment">// 构建客户端程序</span></span><br><span class="line">HelloService.Client client = <span class="keyword">new</span> HelloService.Client(compactProtocol);</span><br><span class="line"></span><br><span class="line">People people = <span class="keyword">new</span> People();</span><br><span class="line"><span class="comment">// 调用远端方法</span></span><br><span class="line">client.SetPeople(people);</span><br></pre></td></tr></table></figure>



<h3 id="JAVA-服务端"><a href="#JAVA-服务端" class="headerlink" title="JAVA 服务端"></a>JAVA 服务端</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置端口号和超时时间，创建Transport</span></span><br><span class="line">TServerSocket tServerSocket = <span class="keyword">new</span> TServerSocket(port,clientTimeout);</span><br><span class="line">TServer.Args tArgs = <span class="keyword">new</span> TServer.Args(tServerSocket);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为Transport创建Protocol</span></span><br><span class="line"><span class="comment">// 注意，这里的TCompactProtocol和客户端应该保持一致</span></span><br><span class="line">tArgs.protocolFactory(<span class="keyword">new</span> TCompactProtocol.Factory());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为Protocol创建Processor</span></span><br><span class="line">TProcessor tprocessor = <span class="keyword">new</span> HelloService.Processor&lt;HelloService.Iface&gt;(<span class="keyword">new</span> HelloServiceHandler());</span><br><span class="line">tArgs.processor(tprocessor);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Server并启动</span></span><br><span class="line"><span class="comment">// 这里使用TSimpleServer，实际情况可用其他实现</span></span><br><span class="line">TServer server = <span class="keyword">new</span> TSimpleServer(tArgs);</span><br><span class="line">server.serve();</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>跨语言</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
        <tag>RPC</tag>
        <tag>C#</tag>
        <tag>跨语言</tag>
      </tags>
  </entry>
</search>
